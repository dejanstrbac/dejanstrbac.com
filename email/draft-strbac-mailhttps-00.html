<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Mail/HTTPS</title>
<meta content="Dejan Strbac" name="author">
<meta content="
       We propose a pull-based messaging scheme leveraging the HTTP protocol over TLS (HTTPS) for universal, message transfer. This messaging overlay tackles the challenges encountered in SMTP messaging, including concerns related to security, authenticity, spam, privacy, size limitations and message lifecycle. Moreover, Mail/HTTPS is to make delivery, operation and maintenance of messaging systems no more complex than that of personal web sites. 
    " name="description">
<meta content="xml2rfc 3.17.4" name="generator">
<meta content="draft-strbac-mailhttps-00.txt" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.17.4
    Python 3.11.4
    ConfigArgParse 1.5.5
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.9.1
    pycountry 22.3.5
    PyYAML 6.0.1
    requests 2.31.0
    setuptools 67.6.1
    six 1.16.0
    wcwidth 0.2.6
-->
<link href="draft-strbac-mailhttps-00.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef,
.iref + a[href].internal {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body class="xml2rfc">
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Mail/HTTPS</td>
<td class="right">December 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Strbac</td>
<td class="center">Expires 17 June 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-strbac-mailhttps-00.txt</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-12-15" class="published">15 December 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-06-17">17 June 2024</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Strbac</div>
<div class="org">Mercata</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Mail/HTTPS</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">We propose a pull-based messaging scheme leveraging the HTTP protocol over TLS (HTTPS) for universal, message transfer. This messaging overlay tackles the challenges encountered in SMTP messaging, including concerns related to security, authenticity, spam, privacy, size limitations and message lifecycle. Moreover, Mail/HTTPS is to make delivery, operation and maintenance of messaging systems no more complex than that of personal web sites.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 17 June 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-background" class="internal xref">Background</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-deliverability" class="internal xref">Deliverability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-flow-overview" class="internal xref">Flow Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="auto internal xref">2.4</a>.  <a href="#name-storage" class="internal xref">Storage</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-authors-and-readers" class="internal xref">Authors and Readers</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-address" class="internal xref">Address</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-format" class="internal xref">Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-examples" class="internal xref">Examples</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-address-secrecy" class="internal xref">Address Secrecy</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-connection-identifiers-link" class="internal xref">Connection Identifiers (Links)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-example" class="internal xref">Example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-mail-agent" class="internal xref">Mail Agent</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-discovery" class="internal xref">Discovery</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="auto internal xref">6.1.1</a>.  <a href="#name-example-configuration" class="internal xref">Example Configuration</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="auto internal xref">6.1.2</a>.  <a href="#name-optimal-configuration" class="internal xref">Optimal Configuration</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-public-profile" class="internal xref">Public Profile</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-format-2" class="internal xref">Format</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-multiplicity" class="internal xref">Multiplicity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-attributes" class="internal xref">Attributes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.1">
                    <p id="section-toc.1-1.7.2.3.2.1.1"><a href="#section-7.3.1" class="auto internal xref">7.3.1</a>.  <a href="#name-required" class="internal xref">Required</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.2">
                    <p id="section-toc.1-1.7.2.3.2.2.1"><a href="#section-7.3.2" class="auto internal xref">7.3.2</a>.  <a href="#name-optional" class="internal xref">Optional</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3.2.3">
                    <p id="section-toc.1-1.7.2.3.2.3.1"><a href="#section-7.3.3" class="auto internal xref">7.3.3</a>.  <a href="#name-custom" class="internal xref">Custom</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-profile-image" class="internal xref">Profile Image</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4.2.1">
                    <p id="section-toc.1-1.7.2.4.2.1.1"><a href="#section-7.4.1" class="auto internal xref">7.4.1</a>.  <a href="#name-privacy-concerns" class="internal xref">Privacy Concerns</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-crypto-algorithms" class="internal xref">Crypto Algorithms</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-fingerprinting" class="internal xref">Fingerprinting</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-signing" class="internal xref">Signing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-encryption" class="internal xref">Encryption</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.1">
                    <p id="section-toc.1-1.8.2.3.2.1.1"><a href="#section-8.3.1" class="auto internal xref">8.3.1</a>.  <a href="#name-symmetric" class="internal xref">Symmetric</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3.2.2">
                    <p id="section-toc.1-1.8.2.3.2.2.1"><a href="#section-8.3.2" class="auto internal xref">8.3.2</a>.  <a href="#name-asymmetric" class="internal xref">Asymmetric</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-message-objects" class="internal xref">Message Objects</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-lifetime" class="internal xref">Lifetime</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.1">
                    <p id="section-toc.1-1.9.2.1.2.1.1"><a href="#section-9.1.1" class="auto internal xref">9.1.1</a>.  <a href="#name-private-messages" class="internal xref">Private Messages</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1.2.2">
                    <p id="section-toc.1-1.9.2.1.2.2.1"><a href="#section-9.1.2" class="auto internal xref">9.1.2</a>.  <a href="#name-broadcasts" class="internal xref">Broadcasts</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-message-access-rights-deliv" class="internal xref">Message Access Rights &amp; Delivery Confirmation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-message-id" class="internal xref">Message-Id</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-payload" class="internal xref">Payload</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.1">
                    <p id="section-toc.1-1.9.2.4.2.1.1"><a href="#section-9.4.1" class="auto internal xref">9.4.1</a>.  <a href="#name-encoding" class="internal xref">Encoding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.2">
                    <p id="section-toc.1-1.9.2.4.2.2.1"><a href="#section-9.4.2" class="auto internal xref">9.4.2</a>.  <a href="#name-plaintext" class="internal xref">Plaintext</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.3">
                    <p id="section-toc.1-1.9.2.4.2.3.1"><a href="#section-9.4.3" class="auto internal xref">9.4.3</a>.  <a href="#name-files-attachments" class="internal xref">Files (Attachments)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4.2.4">
                    <p id="section-toc.1-1.9.2.4.2.4.1"><a href="#section-9.4.4" class="auto internal xref">9.4.4</a>.  <a href="#name-size" class="internal xref">Size</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-headers" class="internal xref">Headers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.1">
                    <p id="section-toc.1-1.9.2.5.2.1.1"><a href="#section-9.5.1" class="auto internal xref">9.5.1</a>.  <a href="#name-envelope" class="internal xref">Envelope</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.2">
                    <p id="section-toc.1-1.9.2.5.2.2.1"><a href="#section-9.5.2" class="auto internal xref">9.5.2</a>.  <a href="#name-categorization" class="internal xref">Categorization</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.3">
                    <p id="section-toc.1-1.9.2.5.2.3.1"><a href="#section-9.5.3" class="auto internal xref">9.5.3</a>.  <a href="#name-streams" class="internal xref">Streams</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5.2.4">
                    <p id="section-toc.1-1.9.2.5.2.4.1"><a href="#section-9.5.4" class="auto internal xref">9.5.4</a>.  <a href="#name-no-reply" class="internal xref">No Reply</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-public-links" class="internal xref">Public Links</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-link-sniffing" class="internal xref">Link Sniffing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-contact-discovery" class="internal xref">Contact Discovery</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-notifications" class="internal xref">Notifications</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-payload-2" class="internal xref">Payload</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-identifier" class="internal xref">Identifier</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="auto internal xref">11.3</a>.  <a href="#name-lifetime-2" class="internal xref">Lifetime</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-11.4" class="auto internal xref">11.4</a>.  <a href="#name-verification" class="internal xref">Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#section-11.5" class="auto internal xref">11.5</a>.  <a href="#name-execution" class="internal xref">Execution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#section-11.6" class="auto internal xref">11.6</a>.  <a href="#name-suppressions" class="internal xref">Suppressions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-address-expansions" class="internal xref">Address Expansions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-envelope-2" class="internal xref">Envelope</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-content-headers-2" class="internal xref">Content Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-replies" class="internal xref">Replies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="auto internal xref">13.1</a>.  <a href="#name-automatic-replies" class="internal xref">Automatic Replies</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-api" class="internal xref">API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#section-14.1" class="auto internal xref">14.1</a>.  <a href="#name-authentication" class="internal xref">Authentication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1.2.1">
                    <p id="section-toc.1-1.14.2.1.2.1.1"><a href="#section-14.1.1" class="auto internal xref">14.1.1</a>.  <a href="#name-sotn-scheme" class="internal xref">SOTN Scheme</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#section-14.2" class="auto internal xref">14.2</a>.  <a href="#name-public-api" class="internal xref">Public API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.1">
                    <p id="section-toc.1-1.14.2.2.2.1.1"><a href="#section-14.2.1" class="auto internal xref">14.2.1</a>.  <a href="#name-discovery-2" class="internal xref">Discovery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.2">
                    <p id="section-toc.1-1.14.2.2.2.2.1"><a href="#section-14.2.2" class="auto internal xref">14.2.2</a>.  <a href="#name-provisioning" class="internal xref">Provisioning</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.3">
                    <p id="section-toc.1-1.14.2.2.2.3.1"><a href="#section-14.2.3" class="auto internal xref">14.2.3</a>.  <a href="#name-profile" class="internal xref">Profile</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.4">
                    <p id="section-toc.1-1.14.2.2.2.4.1"><a href="#section-14.2.4" class="auto internal xref">14.2.4</a>.  <a href="#name-profile-image-2" class="internal xref">Profile Image</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.5">
                    <p id="section-toc.1-1.14.2.2.2.5.1"><a href="#section-14.2.5" class="auto internal xref">14.2.5</a>.  <a href="#name-links" class="internal xref">Links</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.6">
                    <p id="section-toc.1-1.14.2.2.2.6.1"><a href="#section-14.2.6" class="auto internal xref">14.2.6</a>.  <a href="#name-notifications-2" class="internal xref">Notifications</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2.2.7">
                    <p id="section-toc.1-1.14.2.2.2.7.1"><a href="#section-14.2.7" class="auto internal xref">14.2.7</a>.  <a href="#name-messages" class="internal xref">Messages</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3">
                <p id="section-toc.1-1.14.2.3.1"><a href="#section-14.3" class="auto internal xref">14.3</a>.  <a href="#name-private-api" class="internal xref">Private API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.1">
                    <p id="section-toc.1-1.14.2.3.2.1.1"><a href="#section-14.3.1" class="auto internal xref">14.3.1</a>.  <a href="#name-authenticated-discovery" class="internal xref">Authenticated Discovery</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.2">
                    <p id="section-toc.1-1.14.2.3.2.2.1"><a href="#section-14.3.2" class="auto internal xref">14.3.2</a>.  <a href="#name-notifications-3" class="internal xref">Notifications</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.3">
                    <p id="section-toc.1-1.14.2.3.2.3.1"><a href="#section-14.3.3" class="auto internal xref">14.3.3</a>.  <a href="#name-messages-2" class="internal xref">Messages</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.4">
                    <p id="section-toc.1-1.14.2.3.2.4.1"><a href="#section-14.3.4" class="auto internal xref">14.3.4</a>.  <a href="#name-profile-2" class="internal xref">Profile</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.5">
                    <p id="section-toc.1-1.14.2.3.2.5.1"><a href="#section-14.3.5" class="auto internal xref">14.3.5</a>.  <a href="#name-profile-image-3" class="internal xref">Profile Image</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.6">
                    <p id="section-toc.1-1.14.2.3.2.6.1"><a href="#section-14.3.6" class="auto internal xref">14.3.6</a>.  <a href="#name-links-2" class="internal xref">Links</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.7">
                    <p id="section-toc.1-1.14.2.3.2.7.1"><a href="#section-14.3.7" class="auto internal xref">14.3.7</a>.  <a href="#name-vault" class="internal xref">Vault</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.3.2.8">
                    <p id="section-toc.1-1.14.2.3.2.8.1"><a href="#section-14.3.8" class="auto internal xref">14.3.8</a>.  <a href="#name-archives" class="internal xref">Archives</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="auto internal xref">15.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="auto internal xref">15.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="terminology">
<section id="section-1">
      <h2 id="name-terminology">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-2.1">Mail/HTTPS: the pull-based messaging scheme defined in this document<a href="#section-1-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.2">MoH: an acronym of Mail/HTTPS<a href="#section-1-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.3">SMTP-email: push-based email commonly in use today, utilizing SMTP protocol<a href="#section-1-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.4">Mail agent: an always online service which stores and forwards messages.<a href="#section-1-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.5">Home mail agent: a mail agent responsible for mails of a given domain or user.<a href="#section-1-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.6">Author: person or system authoring messages, a modern replacement for "sender."<a href="#section-1-2.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.7">Reader: person or system authorized to retrieve and read messages.<a href="#section-1-2.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.8">Connection identifier: a hash of two addresses, uniquely identifying a connection between two email users.<a href="#section-1-2.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-2.9">Link: a synonym for a connection identifier.<a href="#section-1-2.9" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="introduction">
<section id="section-2">
      <h2 id="name-introduction">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-2-1">Mail/HTTPS (Mail over HTTPS, or MoH) is a modern, asynchronous web-based messaging system. It's an open, publicly accessible, universally applicable overlay that takes advantage of the well-established web infrastructure and the HTTPS protocol. Mail/HTTPS eliminates the necessity for outdated and complex mail protocol suites that are still largely in use. By offering simple yet highly secure building blocks, Mail/HTTPS enables the creation of innovative, more secure messaging, authentication, and open social networking systems.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The primary objective of Mail/HTTPS is to combat global spam and enhance the overall health and trust of internet communication for everyone. It achieves this by providing absolute privacy, security, and reliability without relying on, or trusting any third-party entities.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">Drawing from our extensive experience in providing global email services, we anticipate that Mail/HTTPS infrastructure requirements are roughly at least 80% lower compared to SMTP-email for a user base of the same size. Mail/HTTPS not only addresses major email issues but also may deliver a substantial environmental benefit by significantly reducing the computational power requirement.<a href="#section-2-3" class="pilcrow">¶</a></p>
<div id="background">
<section id="section-2.1">
        <h3 id="name-background">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-background" class="section-name selfRef">Background</a>
        </h3>
<p id="section-2.1-1">Email has evolved into a crucial communication method, but the conventional push-based SMTP email model is ill-suited to meet the demands of modern communication. Numerous Requests For Comments (RFC) have been developed to address challenges such as spam, phishing, enhancing authenticity guarantees, reputation, deliverability and improving overall email security. While the problems may seem to have reduced over the past decades, with the continuous growth of email, they have also quantitatively scaled up. No solution is in sight.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">The lack of significant changes in the email landscape, coupled with its complexity has led to minimal progress. Adapting abusers continually pose challenges, making email management and hosting increasingly complex and expensive. Since spam filtering and privacy are conflicting objectives, finding a solution for the push model of messaging remains elusive.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Email however serves as a fundamental component of the Internet, playing a crucial role in open communication. Without email, obtaining an account with online services, or performing any commercial transaction online would be unimaginable as email addresses are universally considered online identities. This growing complexity surrounding email systems, lobbied for by largest providers, is leading to a trend of centralized control, which poses a threat to the core principles and ideals of an interoperable, democratic and open Internet.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deliverability">
<section id="section-2.2">
        <h3 id="name-deliverability">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-deliverability" class="section-name selfRef">Deliverability</a>
        </h3>
<p id="section-2.2-1">Deliverability is one of the most important terms of SMTP based email. This sender-invented word has erroneously entered the colloquial language due to the ever-present issues of push-email.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">Deliverability stands for the ease of access to one's inbox. This ironically also represents the core issue of push-email, as interests of senders and recipients most often do not align. By any sane standards, access to one's top of the messages queue - inbox, should never be in the hands of any sender but only the queue owner.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">It is time to forget the old terminology: spam filtering, blacklists, bounces, reputations and deliverability. Messages should never be rejected, queued, quarantined or deferred, and especially not without final recipient's knowledge. The dependency on middle-men, providers and postmasters must be a thing of the past.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">In Mail/HTTPS, it is the final reader that determines deliverability, subscriptions and mailbox access overall, and never the author (sender), or the infrastructures in between including that of the reader itself.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="flow-overview">
<section id="section-2.3">
        <h3 id="name-flow-overview">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-flow-overview" class="section-name selfRef">Flow Overview</a>
        </h3>
<p id="section-2.3-1">In Mail/HTTPS, each email domain may point to one or more always-online mail agents, similar to Mail-Exchange (MX) hosts in SMTP-email. Unlike to MX hosts though, mail agents do not accept inbound messages, but rather only cache outbound messages for the readers to pick them up.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">On author's (sender) side:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-3.1">Author composes a message and either encrypts it in a mode where only final readers can decrypt it and its meta content, or signs it as a public broadcast.<a href="#section-2.3-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-3.2">Upon authoring a message, the author uploads own message to at least one of own domain's mail agents.<a href="#section-2.3-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-3.3">Upon a successful upload, if the message has a finite number of readers, author's mail client notifies directly the mail agents of the readers of the presence of a new message. If the message is a broadcast, no notification is required, but all contact MAY be notified.<a href="#section-2.3-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-4">On reader's (recipient) side:<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-5.1">Readers' mail clients periodically poll all contacts' home agents directly for broadcast updates.<a href="#section-2.3-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-5.2">Readers' mail clients occasionally check own home agents for notifications. Once client retrieves the notification from the message author, it verifies their authenticity locally.<a href="#section-2.3-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-5.3">Notifications of unknown authors are presented as contact requests. Should the reader verify and accept the request by adding the contact to own address book, the notification is treated as verified.<a href="#section-2.3-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-5.4">Upon successful notification verification, the reader makes a list request of private messages to the author's home agent. Reader's mail client retrieves (downloads) listed messaged to local storage.<a href="#section-2.3-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-5.5">Messages are either decrypted during download or locally after the download completion.<a href="#section-2.3-5.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-6">The process permits instant availability of messages for readers, without the need for relaying by intermediaries as is the case in SMTP-email. It scales up for any number of readers and supports broadcasts, where readers willingly poll for updates periodically from own contacts.<a href="#section-2.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="storage">
<section id="section-2.4">
        <h3 id="name-storage">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-storage" class="section-name selfRef">Storage</a>
        </h3>
<p id="section-2.4-1">Mail/HTTPS concerns itself only with the transfer of messages from authors to readers. Permanent storage of messages is intentionally not part of the messaging scheme. For a comparison, SMTP-email always binds message relaying to a storage of the very same provider.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">Users may at their convenience configure own mail clients to re-encrypt messages and sync with a central storage of their choice, effectively maintaining the desired level of privacy throughout the message lifecycle.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authors-and-readers">
<section id="section-3">
      <h2 id="name-authors-and-readers">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-authors-and-readers" class="section-name selfRef">Authors and Readers</a>
      </h2>
<p id="section-3-1">Unlike traditional SMTP-email, where terms "senders" and "recipients" are used, Mail/HTTPS employs a passive terminology of "authors" and "readers". In this system, authors compose messages and share them within their own environment with the public or specific readers only. Readers, on the other hand, MAY retrieve messages from authors if they are interested in the author and their messages.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">This shift in terminology promotes a more dynamic and user-centric approach to email communication, where users have full control over their interactions and messages.<a href="#section-3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="address">
<section id="section-4">
      <h2 id="name-address">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-address" class="section-name selfRef">Address</a>
      </h2>
<p id="section-4-1">Mail/HTTPS retains the traditional addressing scheme used in SMTP-email systems, with minor normalization based on de-facto accepted addressing scheme by the majority.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This dual usage allows for the convenience of seamlessly transitioning between legacy and Mail/HTTPS systems without the need for significant changes in the user experience. The address space compatibility also facilitates transitioning.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">SMTP-email refers to addresses as "email" addresses due to their exclusive email applicability. Their scope is however extended in Mail/HTTPS. They represent users, their online account, profile, public information, broadcasts, data etc., not just mere email addresses. In this document we will refer to what is commonly called "email address" as just address.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="format">
<section id="section-4.1">
        <h3 id="name-format">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-format" class="section-name selfRef">Format</a>
        </h3>
<p id="section-4.1-1">Addresses serve a purpose beyond mere message transmission. They have evolved into a fundamental digital identity, functioning as the primary identifier and recovery mechanism throughout the online realm. Although BigTech attempts to monopolize email addresses by necessitating users to create accounts on their exclusive domains, the reality is that email addresses are inherently decentralized and accessible to all individuals.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Unlike <span>[<a href="#RFC5322" class="cite xref">RFC5322</a>]</span> email addresses, which have a very liberal format due to historical reasons and long-obsolete features, the streamlined format of Mail/HTTPS reduces unnecessary challenges in validating and parsing addresses, as well as minimizing discrepancies between different systems. Mail/HTTPS employs a simplified address format that has proven to be easy to understand and "good-enough" over time:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-3">
<pre>
addr-spec         = local-part "@" hostname
local-part        = (letter | digit) {alphanumeric-char}
alphanumeric-char = letter | digit | "-" | "+" | "." | "_"
letter            = "A" | "B" | ... | "Z" | "a" | "b" | ... | "z"
digit             = "0" | "1" | ... | "9"
</pre><a href="#section-4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.1-4">The local-part of a Mail/HTTPS address is case-insensitive and MUST NOT exceed a maximum length of 256 characters. Special characters are allowed. Local part MUST NOT start or end with a special character. Special characters MUST NOT be consecutive.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Unicode characters MAY NOT be used in Mail/HTTPS addresses.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">The domain portion of an address functions as an identifier for the location from which mail is retrieved. It is understood as the explicit DNS label of the particular host. The domain portion MAY NOT be an IP address.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">Mail/HTTPS addresses intentionally do not include display names in the addresses as these have been misused greatly in SMTP based email. The display name of an address MUST be retrieved from its online profile.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples">
<section id="section-4.2">
        <h3 id="name-examples">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
        </h3>
<div class="alignLeft art-text artwork" id="section-4.2-1">
<pre>
dejan@mercata.com
dejan+tag@strbac.com
this_is_a_valid_email_address@group.example.com
george-work@phillips.com
jeff.kloster@bigco.org
jimmy1988@weasy.net
</pre><a href="#section-4.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="address-secrecy">
<section id="section-4.3">
        <h3 id="name-address-secrecy">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-address-secrecy" class="section-name selfRef">Address Secrecy</a>
        </h3>
<p id="section-4.3-1">In traditional SMTP-email systems, preserving the secrecy of email addresses is vital, especially for famous individuals, commonly sought-after institutions and public figures. Exposed email addresses are nowadays susceptible to harvesting, spam, phishing, ransomware and unsolicited messages, leading to privacy concerns and potential security risks.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">However, in the Mail/HTTPS system, exposing an address does not pose any risks. Unlike SMTP-email, address knowledge does not grant inbox access. This distinction ensures a higher level of security and privacy for users, allowing them to share their addresses publicly with confidence.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">The implementation of this restriction is achieved through the use of an address book containing mutual connection identifiers, calculated from the addresses pair. These identifiers serve as "links" between email users and act as an anonymized allow list. Such anonymization also hides communication logs and metadata from eventual third-party providers.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="connection-identifiers-links">
<section id="section-5">
      <h2 id="name-connection-identifiers-link">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-connection-identifiers-link" class="section-name selfRef">Connection Identifiers (Links)</a>
      </h2>
<p id="section-5-1">Mail/HTTPS restricts messaging to parties that have mutually agreed to engage in a message exchange. Messages are shared only among authorized and consenting parties, enhancing privacy and security in the communication process.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">To safeguard users from unauthorized messages while preserving the privacy of correspondents' identities from third parties such as service or infrastructure providers, a distinct and constant connection identifier is created for each email connection established between two parties. This identifier is called a mail "link" and is derived from two addresses.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Mail/HTTPS links ensure that the identities of the correspondents remain confidential and undisclosed to the email service providers throughout the duration of the email exchange, while still allowing service providers to determine whether a request is authorized or not.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The link is generated by taking two addresses, lowercasing them, ordering them alphabetically, concatenating them, and then applying the bare SHA2 hash function defined in <span>[<a href="#RFC6234" class="cite xref">RFC6234</a>]</span>, with its result represented in hex encoding. The use of SHA2 hash function ensures that the original addresses are transformed into irreversible, fixed-length hash values, protecting the correspondents' identities from direct exposure to the email service providers. The resulting hash MUST be considered case insensitive.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">The deliberate omission of a hashing salt is intentional. Utilizing common connection identifiers between two parties allows for efficient access rights determination and facilitates the discovery of network connections, as further elaborated in this document.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="example">
<section id="section-5.1">
        <h3 id="name-example">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-example" class="section-name selfRef">Example</a>
        </h3>
<p id="section-5.1-1">For two example addresses "user2@Domain2.tld" and "USER1@domain1.tld.", the resulting link or connection identifier is constructed as following:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-2">
<li id="section-5.1-2.1">The lowercased addresses are ordered alphabetically:<a href="#section-5.1-2.1" class="pilcrow">¶</a>
</li>
        </ol>
<div class="alignLeft art-text artwork" id="section-5.1-3">
<pre>
    user1@domain1.tld
    user2@domain2.tld
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal type-1" id="section-5.1-4">
<li id="section-5.1-4.1">The two addresses are concatenated without any separators:<a href="#section-5.1-4.1" class="pilcrow">¶</a>
</li>
        </ol>
<div class="alignLeft art-text artwork" id="section-5.1-5">
<pre>
    user1@domain1.tlduser2@domain2.tld
</pre><a href="#section-5.1-5" class="pilcrow">¶</a>
</div>
<ol start="1" type="1" class="normal type-1" id="section-5.1-6">
<li id="section-5.1-6.1">The SHA2 hash is calculated from the concatenated string:<a href="#section-5.1-6.1" class="pilcrow">¶</a>
</li>
        </ol>
<div class="alignLeft art-text artwork" id="section-5.1-7">
<pre>
  c841f291d745ae1d3af3bbd4f86e1c184c6c1e6cdd8ed77a64316e12ed0f6a19
</pre><a href="#section-5.1-7" class="pilcrow">¶</a>
</div>
<p id="section-5.1-8">The final hash value becomes the unique connection identifier, the "link" for the email connection between "user1@domain1.tld" and "user2@domain2.tld".<a href="#section-5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="mail-agent">
<section id="section-6">
      <h2 id="name-mail-agent">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-mail-agent" class="section-name selfRef">Mail Agent</a>
      </h2>
<p id="section-6-1">The underlying architecture of Mail/HTTPS functions as a store-and-forward system using always online mail agents, similar to the Mail-Exchange (MX) relays of SMTP based email. This approach is vital for supporting asynchronous communication, enabling messages to be authored and read at different intervals.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Unlike SMTP-email systems that rely on Mail Transfer Agents (MTAs) for message relaying, which involve at least one additional message retransmission, Mail/HTTPS agents do not relay messages further. These agents receive messages from users (authors) over HTTPS and store them locally until the designated readers retrieve them and before message expiry time.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The HTTP protocol was designed for this exact usage and is conveniently utilized in Mail/HTTPS. Message transmission is achieved through a single HTTP upload and single download per reader, simplifying the process and reducing the risk of message loss or delay. Additionally, messages of any size are instantly available upon upload.<a href="#section-6-3" class="pilcrow">¶</a></p>
<div id="discovery">
<section id="section-6.1">
        <h3 id="name-discovery">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-discovery" class="section-name selfRef">Discovery</a>
        </h3>
<p id="section-6.1-1">To initiate communication, communicating parties must first discover each other's mail agents.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">SMTP based email relies heavily on DNS records to discover the email destination of a given domain.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">In Mail/HTTPS however, the discovery method serves the opposite purpose, to deduct the location from where to retrieve messages, profile information for a given address, and also where to send notifications. The authenticity is self-validated by retrieving messages directly from the origin via strict HTTPS and may be further improved with a DNSSEC <span>[<a href="#RFC9364" class="cite xref">RFC9364</a>]</span> deployment for the domain.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">Mail/HTTPS intentionally does not use DNS based discovery. SMTP email predates the web and is incompatible with its document sharing ideas. To this day, direct interaction with email services from the web is not possible, and for good security reasons. To support new interactions, Mail/HTTPS is a web-native, and it can fully be used via the web and the browser, securely, from discovery up to message retrieval.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">To discover responsible mail agents for an address, mail clients MUST check for existence of a file at a well-known URI, deduced from the host part of a given address. Well-known URIs are defined in <span>[<a href="#RFC8615" class="cite xref">RFC8615</a>]</span>.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">For a given address LOCAL_PART@HOST_PART, the Mail/HTTPS well-known file is attempted at the following URIs in fail-over manner:<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-7">
<pre>
HTTPS GET https://HOST_PART/.well-known/mail.txt
HTTPS GET https://mail.HOST_PART/.well-known/mail.txt
</pre><a href="#section-6.1-7" class="pilcrow">¶</a>
</div>
<p id="section-6.1-8">The well-known URI MUST be retrieved over HTTPS and over a trusted connection. File contents served over an un-trusted connection MUST be ignored.<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<p id="section-6.1-9">The retrieved file MUST be a valid text file representing Mail/HTTPS service configuration file. Invalid contents are to be ignored in their entirety.<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<p id="section-6.1-10">If the configuration file is present and valid, its content should be read to determine possible Mail/HTTPS service delegation. The configuration file is a simple text file with hostnames of delegated mail agents on each line. Multiple mail agent hostnames MAY be listed. Should more be present, only the first three valid hosts SHOULD be considered. The well-known file determines the order of accessing the mail agents.<a href="#section-6.1-10" class="pilcrow">¶</a></p>
<p id="section-6.1-11">Each line of the well-known file MUST be trimmed for surrounding whitespace before being considered.
Empty lines and those starting with a hash (#) MUST be ignored as comments. Invalid hostnames MUST be ignored.<a href="#section-6.1-11" class="pilcrow">¶</a></p>
<p id="section-6.1-12">If no well-known files are available or no valid mail agents are determined for a given address LOCAL_PART@HOST_PART, final attempt for mail agent should be assumed for hostname "mail.HOST_PART", a subdomain "mail" of the address HOST_PART.<a href="#section-6.1-12" class="pilcrow">¶</a></p>
<p id="section-6.1-13">For a selected MAIL_AGENT_HOSTNAME to be considered a valid Mail/HTTPS mail agent for a HOST_PART, the host MUST respond with an HTTP OK status 200 to a domain delegation check via a HEAD (or GET) request at URI:<a href="#section-6.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-14">
<pre>
HTTPS HEAD https://MAIL_AGENT_HOSTNAME/mail/HOST_PART
</pre><a href="#section-6.1-14" class="pilcrow">¶</a>
</div>
<p id="section-6.1-15">All determined valid hostnames are assumed to have a copy of all users data. Upon authoring messages, mail clients MUST respect the setting and MUST store authored messages on at least two of the listed mail agent hosts, respecting order in upload attempts.<a href="#section-6.1-15" class="pilcrow">¶</a></p>
<p id="section-6.1-16">When querying and retrieving messages, all mail agent hostnames listed in the well-known file MUST be queried.<a href="#section-6.1-16" class="pilcrow">¶</a></p>
<div id="example-configuration">
<section id="section-6.1.1">
          <h4 id="name-example-configuration">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-example-configuration" class="section-name selfRef">Example Configuration</a>
          </h4>
<div class="alignLeft art-text artwork" id="section-6.1.1-1">
<pre>
# This is a comment
mail.otherdomain1.tld
otherdomain2.tld
</pre><a href="#section-6.1.1-1" class="pilcrow">¶</a>
</div>
<p id="section-6.1.1-2">In the example above, the Mail/HTTPS service is delegated to hosts mail.otherdomain1.tld and otherdomain2.tld.<a href="#section-6.1.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1.1-3">Authored messages MUST be uploaded to both hosts. Upon listing messages, readers MUST query both hosts too. Upon profile updates, all hosts must be updated.<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="optimal-configuration">
<section id="section-6.1.2">
          <h4 id="name-optimal-configuration">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-optimal-configuration" class="section-name selfRef">Optimal Configuration</a>
          </h4>
<p id="section-6.1.2-1">Discovery prioritizes well-known file and only falls back to 'mail' subdomain in case the file is not available. To optimize this discovery, it is RECOMMENDED to use the service on the 'mail' subdomain and include that hostname in the well-known file.<a href="#section-6.1.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2-2">Should the web service serving the well-known file be unavailable, the assumed 'mail' subdomain would still allow service access.<a href="#section-6.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="public-profile">
<section id="section-7">
      <h2 id="name-public-profile">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-public-profile" class="section-name selfRef">Public Profile</a>
      </h2>
<p id="section-7-1">The advent of email predates the widespread use of the web and the emergence of social networking platforms that now permeate both our personal and professional lives.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">In today's interconnected world, it is immensely valuable to have insights into someone's current status, availability, and sometimes even their location. This information aids in establishing effective communication and helps individuals understand the context in which they are interacting. Additionally, certain details may extend beyond personal contact lists and be publicly visible, contributing to a person's online presence.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Traditional email systems were not originally designed to accommodate additional information about email address holders. To address this limitation, various initiatives were undertaken to introduce proprietary add-ons, standards like Web Finger defined in <span>[<a href="#RFC7033" class="cite xref">RFC7033</a>]</span> and <a href="https://www.ietf.org/archive/id/draft-brand-indicators-for-message-identification-03.txt">BIMI</a>. These efforts aimed to provide user information, profile data, or brand images within email communications.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Despite these endeavors, widespread adoption of these solutions did not materialize. As a result, the most common approach to include supplementary information has been to add a substantial footer in emails. Additionally, relying on provider-dependent profiles and profile images has become a prevailing practice in the absence of widely adopted standards for enhanced email address information and metadata presentation.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Mail/HTTPS takes inspiration from previous efforts to enhance email functionality by introducing user profiles. In this new scheme, each Mail/HTTPS address is linked to a public profile hosted at a standardized URI. The management of these profiles is handled by the individual's mail agent, providing a centralized and standardized way to access and display user information associated with the address.<a href="#section-7-5" class="pilcrow">¶</a></p>
<div id="format-1">
<section id="section-7.1">
        <h3 id="name-format-2">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-format-2" class="section-name selfRef">Format</a>
        </h3>
<p id="section-7.1-1">The public email profile is a plain text file in which each line contains key-value pairs. The pairs are separated by a single colon character, with the key and its corresponding value. The order of the lines does not matter.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">The profile MUST contain mandatory attributes as keys and MAY contain additional optional attributes. The attribute keys are case insensitive.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">Profile total size SHOULD not exceed 64KB in size. If this size limit is exceeded, the profile MAY be truncated. The actual maximum size permitted is left to mail clients.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiplicity">
<section id="section-7.2">
        <h3 id="name-multiplicity">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-multiplicity" class="section-name selfRef">Multiplicity</a>
        </h3>
<p id="section-7.2-1">In contrast to social media platforms which typically limit users to a single identity, Mail/HTTPS natively allows usage of multiple profiles through multiple addresses.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Each address has its own single distinct profile and separate addresses allow users to create and manage different personas for various contexts. This separation of profiles empowers users to maintain distinct presentations for private, fun, casual, and professional interactions, providing greater control over their online identity and presentation.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">Users can adapt their communication style and information sharing based on the specific context, just by using different addresses. This is already the norm today with existing addresses, but without attached profiles, it is assumed one single persona shares the addresses. Mail/HTTPS inverts that relation.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attributes">
<section id="section-7.3">
        <h3 id="name-attributes">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-attributes" class="section-name selfRef">Attributes</a>
        </h3>
<div id="required">
<section id="section-7.3.1">
          <h4 id="name-required">
<a href="#section-7.3.1" class="section-number selfRef">7.3.1. </a><a href="#name-required" class="section-name selfRef">Required</a>
          </h4>
<p id="section-7.3.1-1">Public email profiles offer more than just convenience; they also play a crucial role in facilitating message encryption and validation through the exposure of public keys.<a href="#section-7.3.1-1" class="pilcrow">¶</a></p>
<p id="section-7.3.1-2">A standard public email profile should include, at a minimum, the following essential attributes:<a href="#section-7.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.1-3.1">
              <p id="section-7.3.1-3.1.1">Signing-Key: This attribute provides information about the user's public signing key, utilized to prove authored message authenticity. Digital signatures enable readers to validate that a message indeed originated from the claimed sender and has remained unaltered during transmission. Signing key attribute MUST NOT be empty. Profiles without a signing key SHOULD be considered invalid. The following attributes hold the key data:<a href="#section-7.3.1-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.1-3.1.2.1">"algorithm": indicating the signing algorithm for which the key is suitable. By default, Mail/HTTPS uses "ed25519" algorithm which will be assumed if the attribute is not present.<a href="#section-7.3.1-3.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-7.3.1-3.1.2.2">"value": contains the Base64 encoded public key data.<a href="#section-7.3.1-3.1.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-7.3.1-3.1.3">
Example:<a href="#section-7.3.1-3.1.3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.1-3.1.4">
<pre>
Signing-Key: algorithm=ed25519; value=AwzDTCM2GQu56oyFrek0XskQ5FbVHYD8TaFGm/w/kqc=
</pre><a href="#section-7.3.1-3.1.4" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-7.3.1-3.2">
              <p id="section-7.3.1-3.2.1">Updated: The ISO 8601 UTC formatted timestamp indicates the time of the last profile update and SHOULD always be present. When using multiple agents, the profile timestamp permits to identify the most actual data after potential infrastructure issues. Example:<a href="#section-7.3.1-3.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.1-3.2.2">
<pre>
Updated: 2023-10-24T19:04:31Z
</pre><a href="#section-7.3.1-3.2.2" class="pilcrow">¶</a>
</div>
</li>
          </ul>
</section>
</div>
<div id="optional">
<section id="section-7.3.2">
          <h4 id="name-optional">
<a href="#section-7.3.2" class="section-number selfRef">7.3.2. </a><a href="#name-optional" class="section-name selfRef">Optional</a>
          </h4>
<p id="section-7.3.2-1">Allowing profile owners to freely choose all attributes would result in unstructured data that would pose challenges for programmatic utilization. Mail/HTTPS defines a set of optional profile attributes which have defined meaning.<a href="#section-7.3.2-1" class="pilcrow">¶</a></p>
<p id="section-7.3.2-2">The profile attributes cannot repeat unless explicitly stated. If non-repeatable attributes are found more than once, only the first occurrence MUST be considered.<a href="#section-7.3.2-2" class="pilcrow">¶</a></p>
<p id="section-7.3.2-3">All attributes within the user profiles are expected to be and presented in plaintext format. Clients MUST NOT parse attributes for formatting and MUST always present the raw source.<a href="#section-7.3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.2-4.1">About: The attribute provides a brief description or summary of the profile owner's background, interests, or personal statement. It is a free-form attribute.<a href="#section-7.3.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.2">Address-Expansion: If the address serves as a grouping of other addresses, or is a pointer for forwarding further, this attribute holds comma separated destination addresses. If the profile address is meant to receive a copy too, it is expected to be included in the expansion list.<a href="#section-7.3.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.3">Away: If set, the attribute indicates that the user may not read messages until the away status is removed. Mail clients SHOULD warn authors from authoring messages for away readers. Address-Expansion MAY be used for indicating delegations.<a href="#section-7.3.2-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.4">Away-Warning: If set, an attempt to author a message for away reader SHOULD bring up the custom warning which SHOULD be displayed by mail clients.<a href="#section-7.3.2-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.5">Birthday: The attribute indicates the date of birth or birthdate of the profile owner in ISO 8601 format (YYYYMMDD).<a href="#section-7.3.2-4.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.6">Books: The attribute lists literary works or genres that the profile owner likes to read. It is a free-form attribute.<a href="#section-7.3.2-4.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.7">Department: The attribute denotes the specific department or division within the organization where the profile owner works. It is a free-form attribute.<a href="#section-7.3.2-4.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.8">Education: The attribute provides information about the educational background of the profile owner, including schools attended and degrees earned. It is a free-form attribute.<a href="#section-7.3.2-4.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.9">
              <p id="section-7.3.2-4.9.1">Encryption-Key: This attribute holds the user's public encryption key, required for decrypting messages addressed to self. Only intended readers can decrypt and read private messages' contents, providing a high level of confidentiality and data protection. An empty or non-present encryption key attribute indicates that the profile does not accept incoming messages, a feature typically reserved for "no-reply" addresses. The following attributes hold the key data:<a href="#section-7.3.2-4.9.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.3.2-4.9.2.1">"algorithm": indicating the encryption algorithm for which the key is suitable. By default, Mail/HTTPS uses "curve25519xsalsa20poly1305" algorithm which will be assumed if the attribute is not present.<a href="#section-7.3.2-4.9.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-7.3.2-4.9.2.2">"value": contains the Base64 encoded public key data.<a href="#section-7.3.2-4.9.2.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-7.3.2-4.9.3">
Example:<a href="#section-7.3.2-4.9.3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.2-4.9.4">
<pre>
Encryption-Key: algorithm=curve25519xsalsa20poly1305; value=AwzDTCM2GQu56oyFrek0XskQ5FbVHYD8TaFGm/w/kqc=
</pre><a href="#section-7.3.2-4.9.4" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-7.3.2-4.10">Gender: The attribute represents the gender identity or gender expression of the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.11">Interests: The attribute lists hobbies, activities, or topics of interest that the profile owner has indicated. It is a free-form attribute.<a href="#section-7.3.2-4.11" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.12">Job-Title: The attribute specifies the job title or position held by the profile owner within their organization. It is a free-form attribute.<a href="#section-7.3.2-4.12" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.13">Languages: The attribute indicates the languages spoken or understood by the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.13" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.14">
              <p id="section-7.3.2-4.14.1">Last-Seen-Public: This special attribute indicates whether the mail agent should track and make public the time of last retrieval in discovery API calls. Recent retrievals may indicate possibility for more real-time communication when required. Possible values are "Yes" and "No". The attribute SHOULD assume value "Yes" if not present.<a href="#section-7.3.2-4.14.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.2-4.14.2">
<pre>
Last-Seen-Public: Yes
</pre><a href="#section-7.3.2-4.14.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-7.3.2-4.15">
              <p id="section-7.3.2-4.15.1">Last-Signing-Key: This attribute provides user's previous signing key and SHOULD be present after key rotations. The attribute serves the purpose of verifying messages that were authored during key rotations, as well as verifying the user's own API requests on mail agents from their mail clients that are still awaiting key updates. Note that unlike the signing key, the last encryption key is not needed after rotations and SHOULD NOT be present in the profile. Temporary storage of the last encryption key is responsibility of email clients.<a href="#section-7.3.2-4.15.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.2-4.15.2">
<pre>
Last-Signing-Key: algorithm=ed25519; value=AwzDTCM2GQu56oyFrek0XskQ5FbVHYD8TaFGm/w/kqc=
</pre><a href="#section-7.3.2-4.15.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-7.3.2-4.16">Location: The attribute may represent the geographical location such as address or GPS coordinates of the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.16" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.17">Mailing-Address: The attribute represents the physical address or mailing address of the profile owner. The field SHOULD NOT be confused with profile's Mail/HTTPS address which is implicit and not necessary in the profile. It is a free-form attribute.<a href="#section-7.3.2-4.17" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.18">Movies: The attribute lists films or movie genres that the profile owner enjoys. It is a free-form attribute.<a href="#section-7.3.2-4.18" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.19">Music: The attribute indicates the profile owner's preferred music genres, artists, or songs. It is a free-form attribute.<a href="#section-7.3.2-4.19" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.20">Name: This attribute represents the display name associated with the address. Previously, in SMTP-email it was typically written as "name" &lt;address&gt;. The name helps identify the user or entity behind the address and its presence is RECOMMENDED.<a href="#section-7.3.2-4.20" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.21">Notes: The attribute allows for additional remarks or notes about the profile owner, such as preferences, interests, or specific instructions. It is a free-form attribute.<a href="#section-7.3.2-4.21" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.22">Organization: The attribute denotes the name of the company, organization, or institution the profile owner is affiliated with. It is a free-form attribute.<a href="#section-7.3.2-4.22" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.23">Phone: The attribute represents the contact numbers associated with the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.23" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.24">Places-Lived: The attribute encompasses information about the profile owner's previous or current places of residence or significant locations in their life. This attribute is designed to be free-form, meaning that there are no specific formatting requirements or constraints imposed. Users have the flexibility to input the relevant location data in a way that best suits their preferences, allowing for a customizable representation of their lived experiences and important geographical information.<a href="#section-7.3.2-4.24" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.25">Public-Access: The attribute indicates whether the profile owner accepts notifications from unknown links as contact requests. Mail agents of the profile owner implement this policy upon notifications requests. Possible values are "Yes" and "No". The attribute SHOULD assume default value "Yes" if not present.<a href="#section-7.3.2-4.25" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.26">Relationship-Status: The attribute is a free-form attribute and indicates the current relationship status of the profile owner (e.g., single, in a relationship, married, looking, etc.).<a href="#section-7.3.2-4.26" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.27">Sports: The attribute is a free-form and may lists sports activities or teams that the profile owner follows or participates in.<a href="#section-7.3.2-4.27" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.28">Status: The attribute provides the current status message of the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.28" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.29">
              <p id="section-7.3.2-4.29.1">Streams: The attribute provides a coma separated collection of free-form stream tags that readers can use to filter messages during the message pulling process. These tags allow for flexible categorization and organization of messages and can include various labels such as "~family-photos," "~notes," "~events," "~location" etc. Example:<a href="#section-7.3.2-4.29.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3.2-4.29.2">
<pre>
Streams: ~writing, ~family-photos
</pre><a href="#section-7.3.2-4.29.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-7.3.2-4.30">Website: The attribute represents the website associated with the profile owner.<a href="#section-7.3.2-4.30" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-7.3.2-4.31">Work: The attribute provides details about the professional work experience of the profile owner. It is a free-form attribute.<a href="#section-7.3.2-4.31" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="custom">
<section id="section-7.3.3">
          <h4 id="name-custom">
<a href="#section-7.3.3" class="section-number selfRef">7.3.3. </a><a href="#name-custom" class="section-name selfRef">Custom</a>
          </h4>
<p id="section-7.3.3-1">Any non-reserved attribute present in the user's profile is considered custom profile attribute. Such custom attributes MAY be presented by mail clients only following the standard, reserved attributes.<a href="#section-7.3.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="profile-image">
<section id="section-7.4">
        <h3 id="name-profile-image">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-profile-image" class="section-name selfRef">Profile Image</a>
        </h3>
<p id="section-7.4-1">Each address may provide a profile image to be used as a thumbnail as well as profile banner. It serves to clearly identify the user of a given address. It is RECOMMENDED for all addresses to provide a profile image.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">Just as the profile, the profile image MUST be served over HTTPS. Profile images served over insecure connections MUST BE ignored.<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<p id="section-7.4-3">The profile image format MAY be one of the following: JPEG, GIF, PNG, or WebP.<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<p id="section-7.4-4">The profile image size SHOULD not exceed 512KB in size. If this size limit is exceeded, the profile image SHOULD be omitted for a placeholder in the mail client. Mail agents MUST NOT serve placeholders for non-existing or invalid profile images.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<p id="section-7.4-5">The profile image should be square, of equal height and width. The RECOMMENDED image size is 400x400 pixels. The mail agents do not provide alternative sizes of the profile image. It is the responsibility of mail clients to retrieve, resize and cache the profile images.<a href="#section-7.4-5" class="pilcrow">¶</a></p>
<div id="privacy-concerns">
<section id="section-7.4.1">
          <h4 id="name-privacy-concerns">
<a href="#section-7.4.1" class="section-number selfRef">7.4.1. </a><a href="#name-privacy-concerns" class="section-name selfRef">Privacy Concerns</a>
          </h4>
<p id="section-7.4.1-1">In SMTP-email, images are commonly used within HTML messages as "web-bugs" to track events such as opening, as well reader's final IP address and location. Mail/HTTPS profile images are not tied to any particular message and do not invade privacy of the corresponding parties.<a href="#section-7.4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="crypto-algorithms">
<section id="section-8">
      <h2 id="name-crypto-algorithms">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-crypto-algorithms" class="section-name selfRef">Crypto Algorithms</a>
      </h2>
<p id="section-8-1">Mail/HTTPS relies on a combination of asymmetric and symmetric ciphers. The message content is encrypted using symmetric ciphers, effectively avoiding duplication of data for multiple readers. The symmetric cipher key is however encrypted using asymmetric ciphers for each reader.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Both public and private messages are signed using asymmetric keys.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">To ensure adaptability to future developments and prevent the need for versioning, Mail/HTTPS does not depend on or mandate specific algorithms. It anticipates that algorithms will advance over time. What remains consistent is the utilization of a combination of asymmetric and symmetric ciphers.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">The headers of Mail/HTTPS list which ciphers are used for encrypting payloads.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">Embedded encrypted/signed headers include a prefix of the cipher used.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">Minimum REQUIRED checksum algorithms:<a href="#section-8-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-7.1">sha256<a href="#section-8-7.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-8">Minimum REQUIRED symmetric encryption algorithms:<a href="#section-8-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-9.1">xchacha20poly1305<a href="#section-8-9.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-9.2">secretstream_xchacha20poly1305<a href="#section-8-9.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-10">Minimum REQUIRED asymmetric encryption algorithms:<a href="#section-8-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-11.1">curve25519xsalsa20poly1305<a href="#section-8-11.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-12">Minimum REQUIRED signing algorithms:<a href="#section-8-12" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-13.1">ed25519<a href="#section-8-13.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-14">All of these algorithms are conveniently available as part of the <a href="https://doc.libsodium.org/">LibSodium</a> library.<a href="#section-8-14" class="pilcrow">¶</a></p>
<div id="fingerprinting">
<section id="section-8.1">
        <h3 id="name-fingerprinting">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-fingerprinting" class="section-name selfRef">Fingerprinting</a>
        </h3>
<p id="section-8.1-1">After keys rotation, each user keeps previous encryption and signing keys for at least one maximum duration of a message. The previous signing key is published in the user's profile, alongside the actual signing key. The previous public encryption key needs no publishing; its private counterpart should be kept locally in email clients to read messages authored by others shortly before rotation.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">Public key fingerprints are used to identify the key which is needed in a crypto operation, whether decryption or signature verification, without futilely trying multiple keys.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">The fingerprint is simply the SHA256 hash of the key bytes in hex encoding. The resulting fingerprint is precisely 64 characters long and MUST be considered case-insensitive.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="signing">
<section id="section-8.2">
        <h3 id="name-signing">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-signing" class="section-name selfRef">Signing</a>
        </h3>
<p id="section-8.2-1">Each message MUST contain a cryptographical signature of the content checksum. The signature irrefutably identifies the author of the message at the time of the retrieval.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encryption">
<section id="section-8.3">
        <h3 id="name-encryption">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-encryption" class="section-name selfRef">Encryption</a>
        </h3>
<p id="section-8.3-1">Both the content (message payload) and the message content meta-data of private messages MUST be encrypted. To avoid unnecessary copies of the same data for each reader, the message data and headers are encrypted using symmetric ciphers and a random encryption key. The encryption key is further encrypted for each reader using each reader's own public encryption key.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<div id="symmetric">
<section id="section-8.3.1">
          <h4 id="name-symmetric">
<a href="#section-8.3.1" class="section-number selfRef">8.3.1. </a><a href="#name-symmetric" class="section-name selfRef">Symmetric</a>
          </h4>
<p id="section-8.3.1-1">The choice of the symmetric cipher depends on the size of the data and mail client capabilities. Mail/HTTPS relies on LibSodium's constructs for encryption of both large and small payloads. By small payloads, it is assumed those that are safe to handle completely in memory.<a href="#section-8.3.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.1-2">Message bodies intended for direct representation as well meta-data within message envelopes are commonly considered small payloads.<a href="#section-8.3.1-2" class="pilcrow">¶</a></p>
<p id="section-8.3.1-3">Under large payloads it is assumed files. It is RECOMMENDED that any payload larger than 1 MB SHOULD be transmitted as file rather than a message body, and be encrypted using stream ciphers. It is also RECOMMENDED that mail clients do not display such content directly but rather as attachment.<a href="#section-8.3.1-3" class="pilcrow">¶</a></p>
<div id="message-body">
<section id="section-8.3.1.1">
            <h5 id="name-message-body">
<a href="#section-8.3.1.1" class="section-number selfRef">8.3.1.1. </a><a href="#name-message-body" class="section-name selfRef">Message Body</a>
            </h5>
<p id="section-8.3.1.1-1">Mail/HTTPS uses LibSodium's XChaCha20Poly1305 as default symmetric encryption algorithms for message bodies.<a href="#section-8.3.1.1-1" class="pilcrow">¶</a></p>
<div id="xchacha20poly1305">
<section id="section-8.3.1.1.1">
              <h6 id="name-xchacha20poly1305">
<a href="#section-8.3.1.1.1" class="section-number selfRef">8.3.1.1.1. </a><a href="#name-xchacha20poly1305" class="section-name selfRef">xchacha20poly1305</a>
              </h6>
<p id="section-8.3.1.1.1-1">When the message payload is encrypted using XChaCha20Poly1305, the envelope header "Message-Encryption" should hold the value "xchacha20poly1305" in the attribute "algorithm":<a href="#section-8.3.1.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3.1.1.1-2">
<pre>
Message-Encryption: algorithm=xchacha20poly1305
</pre><a href="#section-8.3.1.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.3.1.1.1-3">This header instructs mail clients with the decryption procedure, which in this case would assume complete in-memory decryption. Mail clients MAY refuse the message decrypting in case the payload size is unsuitable for the algorithm.<a href="#section-8.3.1.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="envelope-meta-data">
<section id="section-8.3.1.2">
            <h5 id="name-envelope-meta-data">
<a href="#section-8.3.1.2" class="section-number selfRef">8.3.1.2. </a><a href="#name-envelope-meta-data" class="section-name selfRef">Envelope Meta-Data</a>
            </h5>
<p id="section-8.3.1.2-1">Meta-data in private messages MUST be encrypted. Mail/HTTPS conveniently uses the same cipher XChaCha20Poly1305 used for small payloads also for meta data encryption.<a href="#section-8.3.1.2-1" class="pilcrow">¶</a></p>
<div id="xchacha20poly1305-1">
<section id="section-8.3.1.2.1">
              <h6 id="name-xchacha20poly1305-2">
<a href="#section-8.3.1.2.1" class="section-number selfRef">8.3.1.2.1. </a><a href="#name-xchacha20poly1305-2" class="section-name selfRef">xchacha20poly1305</a>
              </h6>
<p id="section-8.3.1.2.1-1">When used in headers, the XChaCha20Poly1305 encrypted data is encoded using basic Base64 encoding with padding and given in the attribute "value" along with the attribute algorithm with value "xchacha20poly1305". For example:<a href="#section-8.3.1.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3.1.2.1-2">
<pre>
Message-Headers: algorithm=xchacha20poly1305 value=jErGXHXfee517zia2tO2Z+a2gTmL...
</pre><a href="#section-8.3.1.2.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="large-payloads">
<section id="section-8.3.1.3">
            <h5 id="name-large-payloads">
<a href="#section-8.3.1.3" class="section-number selfRef">8.3.1.3. </a><a href="#name-large-payloads" class="section-name selfRef">Large Payloads</a>
            </h5>
<p id="section-8.3.1.3-1">When encrypting larger payloads, streaming cipher MUST be used with fixed chunk sizes where each chunk is encrypted individually. Mail/HTTPS uses LibSodium's construct SecretStream with tag "secretstream_xchacha20poly1305" as default, assumed stream cipher. Other streaming ciphers MAY be supported.<a href="#section-8.3.1.3-1" class="pilcrow">¶</a></p>
<div id="secretstreamxchacha20poly1305">
<section id="section-8.3.1.3.1">
              <h6 id="name-secretstream_xchacha20poly1">
<a href="#section-8.3.1.3.1" class="section-number selfRef">8.3.1.3.1. </a><a href="#name-secretstream_xchacha20poly1" class="section-name selfRef">secretstream_xchacha20poly1305</a>
              </h6>
<p id="section-8.3.1.3.1-1">The envelope header "Message-Encryption" SHOULD list the algorithm identifier  "secretstream_xchacha20poly1305" in the attribute "algorithm", while the chunk size should be made available in attribute "chunk-size". For example:<a href="#section-8.3.1.3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3.1.3.1-2">
<pre>
Message-Encryption: algorithm=secretstream_xchacha20poly1305; chunk-size=4096
</pre><a href="#section-8.3.1.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.3.1.3.1-3">RECOMMENDED chunk sizes are between 4096 (4KB) and 131072 bytes (128KB), but any size below 1 MB is permitted.<a href="#section-8.3.1.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="asymmetric">
<section id="section-8.3.2">
          <h4 id="name-asymmetric">
<a href="#section-8.3.2" class="section-number selfRef">8.3.2. </a><a href="#name-asymmetric" class="section-name selfRef">Asymmetric</a>
          </h4>
<p id="section-8.3.2-1">Asymmetric encryption is used for encrypting the symmetric encryption key, used for sealing the message payload and headers.<a href="#section-8.3.2-1" class="pilcrow">¶</a></p>
<p id="section-8.3.2-2">Mail/HTTPS utilizes LibSodium library and its anonymous-box primitives based on Curve25519, XSalsa20 and Poly1305 for asymmetric key encryption of small data, identified by "curve25519xsalsa20poly1305". Using LibSodium is not a requirement and any asymmetric public cryptographic cipher could be used in the future.<a href="#section-8.3.2-2" class="pilcrow">¶</a></p>
<p id="section-8.3.2-3">Anonymous box uses readers public key and a freshly generated key pair for encryption. The newly generated public key required for decrypting the message is embedded in the encrypted message itself. Such anonymization shifts the responsibility for the message to the reader, as solely the reader's private key is able to decrypt the message. In addition, it theoretically permits that author and reader use different encryption algorithms, as long as they are both based on asymmetric public key cryptography.<a href="#section-8.3.2-3" class="pilcrow">¶</a></p>
<p id="section-8.3.2-4">Anonymous box does not authenticate messages. Authenticity is instead determined through the provided signature, available only after decrypting the content meta-data.<a href="#section-8.3.2-4" class="pilcrow">¶</a></p>
<p id="section-8.3.2-5">To facilitate identification of the algorithm and encryption key used, additional data is provided along with the encrypted data in the form of header attributes:<a href="#section-8.3.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.3.2-6.1">"algorithm": Encryption algorithm tag, needed to identify the algorithm as it may change in the future. By default, 'curve25519xsalsa20poly1305' is used, identifying the anonymous box cipher.<a href="#section-8.3.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.3.2-6.2">"key": Public encryption key fingerprint, used to encrypt the message and needed to identify the needed reader's key pair to decrypt the message.<a href="#section-8.3.2-6.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.3.2-6.3">"value": The encrypted data in Base64 encoding. The data includes already the anonymized public key needed for decrypting, conveniently embedded by the anonymous box cipher.<a href="#section-8.3.2-6.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.3.2-7">The algorithm tag and the public key fingerprint MUST be considered case-insensitive, while the encrypted data, being Base64 encoded, MUST be considered case sensitive.<a href="#section-8.3.2-7" class="pilcrow">¶</a></p>
<div id="keys-rotations">
<section id="section-8.3.2.1">
            <h5 id="name-keys-rotations">
<a href="#section-8.3.2.1" class="section-number selfRef">8.3.2.1. </a><a href="#name-keys-rotations" class="section-name selfRef">Keys Rotations</a>
            </h5>
<p id="section-8.3.2.1-1">Every user's key pairs (encryption, signing) SHOULD be rotated at least once every 30 days. The rotation MUST NOT be repeated more than once within 7 days, which is the minimum message lifetime duration.<a href="#section-8.3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.3.2.1-2">Email clients are responsible for suggesting and conducting such periodic key rotations to the end user.<a href="#section-8.3.2.1-2" class="pilcrow">¶</a></p>
<p id="section-8.3.2.1-3">It is assumed multiple clients will be using the email service in parallel, just as is the case with email IMAP clients. Upon keys rotation, connected mail clients will stop operation unless they receive key updates. Such updates are provided in special messages of categories "encryption-key" &amp; "signing-key", addressed to self, duly encrypted and signed with existing keys.<a href="#section-8.3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-8.3.2.1-4">The encryption and signing keys MAY be rotated at the same time, but there are no repercussions if they are. Upon signing key rotation, the previous signing key SHOULD be made available in the user's profile under the "Last-Signing-Key" attribute.<a href="#section-8.3.2.1-4" class="pilcrow">¶</a></p>
<p id="section-8.3.2.1-5">Once an mail client retrieves and verifies a new key message, it SHOULD prompt the reader before updating the existing keys. After the maximum message lifetime, any not-yet updated client has to be updated manually.<a href="#section-8.3.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="message-objects">
<section id="section-9">
      <h2 id="name-message-objects">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-message-objects" class="section-name selfRef">Message Objects</a>
      </h2>
<p id="section-9-1">Mail/HTTPS objects are accessible through public URIs (Uniform Resource Identifiers). These URIs provide means for locating and retrieving the Mail/HTTPS objects, ensuring they can be accessed and interacted with by readers.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">The transportation of a message object is accomplished within a single HTTPS request. A message object consists of both metadata and payload, allowing for the inclusion of relevant information about the message as well as the actual content being transmitted.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">Message objects in Mail/HTTPS can be classified as either private or public. Public message objects are accessible to everyone. They lack specified readers and are signed by the author to ensure authenticity. These messages are akin to broadcasts, openly available to anyone interested in their content.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">On the other hand, private message objects are encrypted and can only be accessed by designated readers specified by the author. This encryption ensures the confidentiality and security of the message content, restricting access to authorized readers only.<a href="#section-9-4" class="pilcrow">¶</a></p>
<p id="section-9-5">The metadata of a Mail/HTTPS object is efficiently transferred using HTTP headers, enabling a convenient and streamlined transmission of essential information about the message. While transfer-related metadata is not encrypted, message-specific data, including the author, readers, subject, and other confidential information, may be encrypted to ensure privacy and security during transmission.<a href="#section-9-5" class="pilcrow">¶</a></p>
<div id="lifetime">
<section id="section-9.1">
        <h3 id="name-lifetime">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-lifetime" class="section-name selfRef">Lifetime</a>
        </h3>
<div id="private-messages">
<section id="section-9.1.1">
          <h4 id="name-private-messages">
<a href="#section-9.1.1" class="section-number selfRef">9.1.1. </a><a href="#name-private-messages" class="section-name selfRef">Private Messages</a>
          </h4>
<p id="section-9.1.1-1">It is RECOMMENDED that private Mail/HTTPS messages of most generic category "personal" have a default duration of 7 days (168 hours) from the time of the upload on the mail agent. Authors and their mail clients MAY decide the actual duration of messages on mail agents. Mail agents on their own MUST NOT enforce messages duration. Removal of messages MUST be exclusively reserved for mail clients.<a href="#section-9.1.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1.1-2">Should the reader be unavailable to retrieve the message during the message lifetime, author's mail client SHOULD notify author of the lack of retrieval. Author may decide to re-notify the readers and keep the message for a longer period. Alternatively, author may drop the message.<a href="#section-9.1.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1.1-3">Author's mail client MAY be configured to automatically remove messages collected by all designated readers.<a href="#section-9.1.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1.1-4">Unlike broadcast messages, private messages MAY NOT be pinned.<a href="#section-9.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="broadcasts">
<section id="section-9.1.2">
          <h4 id="name-broadcasts">
<a href="#section-9.1.2" class="section-number selfRef">9.1.2. </a><a href="#name-broadcasts" class="section-name selfRef">Broadcasts</a>
          </h4>
<p id="section-9.1.2-1">Broadcast messages SHOULD have the minimum duration of 7 days (168 hours) from the time of the upload.<a href="#section-9.1.2-1" class="pilcrow">¶</a></p>
<p id="section-9.1.2-2">If messages are pinned, they are stored permanently and offered to readers in each 'list' request. The message pinning is achieved via the header 'Message-Pinned' presence in the message envelope. There SHOULD be no limit on the number of pinned messages.<a href="#section-9.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-access-rights-delivery-confirmation">
<section id="section-9.2">
        <h3 id="name-message-access-rights-deliv">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-message-access-rights-deliv" class="section-name selfRef">Message Access Rights &amp; Delivery Confirmation</a>
        </h3>
<p id="section-9.2-1">Encrypted messages are only decryptable by the final readers as the decryption keys are encrypted using reader's public encryption key. As such, even public visibility of the encrypted messages would not leak any information about the readers and the content itself.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">Nevertheless, in Mail/HTTPS, only designated readers MAY list and retrieve messages from author's mail agents through authenticated requests, effectively confirming pickup by the reader irrefutably. This universal identified "delivery" confirmation is crucial in official, on-the-record messaging. Its absence in SMTP-email has led to many privacy invading techniques where delivery is confirmed without the recipient consent. Mail/HTTPS makes the message pickup and delivery confirmation completely in the hands of the reader. Should the reader decide for the pickup to be executed, the delivery is confirmed cryptographically.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
<p id="section-9.2-3">Access right evaluation and delivery confirmation is done in full anonymity on the mail agent. This is achieved through anonymized authentication where agent operators have no knowledge of the authenticating reader's identity.<a href="#section-9.2-3" class="pilcrow">¶</a></p>
<p id="section-9.2-4">Author's private messages awaiting pickup on mail agents provide in envelope header "Message-Access" a list of connection identifiers and public key fingerprints of designated readers, along with the message decrypting password encrypted anonymously with the reader's public encryption key.<a href="#section-9.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-id">
<section id="section-9.3">
        <h3 id="name-message-id">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-message-id" class="section-name selfRef">Message-Id</a>
        </h3>
<p id="section-9.3-1">SMTP-email provides a considerable degree of flexibility in selecting a Message-Id, often resulting in messages being sent without a Message-Id altogether. In contrast, Mail/HTTPS mandates the use of a Message-Id, as it plays a crucial role in ensuring message retrievability. Unlike SMTP-email, where global uniqueness of Message-Ids is the norm by including the sending domain, Mail/HTTPS requires uniqueness only within the author's mail agent, permitting anonymized identifiers.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">Message-Ids in Mail/HTTPS SHOULD be hexadecimal strings, ranging from 32 to 128 characters in length, containing only numeric digits and characters A to F. Message-Ids SHOULD be treated as case-insensitive, and MUST be URL-safe within the Mail/HTTPS system.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="payload">
<section id="section-9.4">
        <h3 id="name-payload">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-payload" class="section-name selfRef">Payload</a>
        </h3>
<p id="section-9.4-1">In the Mail/HTTPS system, messages are either a body or a file payload. A message MAY NOT contain both simultaneously.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">Private messages undergo a robust encryption process to ensure confidentiality and integrity. The author's mail client encrypts the messages locally using a strong, randomly generated password and a symmetric cipher. For secure sharing with readers, the random password is individually encrypted for each reader. This is achieved by encrypting the password with the reader's public encryption key, obtained from the reader's public profile, and a randomly generated asymmetric key-pair. The private key involved in this encryption is discarded, while the corresponding public key is included alongside the cipher-text of the encrypted message.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4-3">The responsibility for message confidentiality is effectively shifted to the intended readers. Only authorized readers possessing the respective private keys can successfully decrypt and access the private message. The message content remains private and secure throughout transmission and storage.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
<div id="encoding">
<section id="section-9.4.1">
          <h4 id="name-encoding">
<a href="#section-9.4.1" class="section-number selfRef">9.4.1. </a><a href="#name-encoding" class="section-name selfRef">Encoding</a>
          </h4>
<p id="section-9.4.1-1">SMTP-email uses MIME for encoding messages and allows use of character sets other than ASCII. It also permits embedding additional content into single messages. This is historical bagage and has made email messages unnecessarily complicated.<a href="#section-9.4.1-1" class="pilcrow">¶</a></p>
<p id="section-9.4.1-2">HTTP, on which Mail/HTTPS relise, can handle multipart bodies, but this involves complex encoding, decoding, and parsing steps. This complexity is burdensome for both server and client development and is inefficient for large files. Additionally, multipart message segments cannot be sent simultaneously, a strategy that typically speeds up data transfer.<a href="#section-9.4.1-2" class="pilcrow">¶</a></p>
<p id="section-9.4.1-3">Mail/HTTPS does not encode messages beyond encryption in private context. Body of messages, if present, natively supports Unicode. Embedding of additional content into messages is also not possible. Each message is either a text file body or a binary file, transfered within a single HTTP request. Messages that are related MUST reference a parent message by its Message-Id. Email clients' user interfaces SHOULD hide this implementation detail and reconstruct the single-message illusion.<a href="#section-9.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="plaintext">
<section id="section-9.4.2">
          <h4 id="name-plaintext">
<a href="#section-9.4.2" class="section-number selfRef">9.4.2. </a><a href="#name-plaintext" class="section-name selfRef">Plaintext</a>
          </h4>
<p id="section-9.4.2-1">Embedded message content MUST be represented to the reader in its raw, text form, without any parsing or interpretation. If the message content is determined not to be of text content type, the content SHOULD NOT be attempted to be presented to the reader and SHOULD be interpreted as invalid and potentially unsafe.<a href="#section-9.4.2-1" class="pilcrow">¶</a></p>
<p id="section-9.4.2-2">Mail/HTTPS forbids HTML <span>[<a href="#RFC1866" class="cite xref">RFC1866</a>]</span> and similar markup languages which may load remote content or mask link destinations. Any remote content can be easily linked to or included as attachment instead.<a href="#section-9.4.2-2" class="pilcrow">¶</a></p>
<p id="section-9.4.2-3">Clients MAY support a subset of MarkDown <span>[<a href="#RFC7763" class="cite xref">RFC7763</a>]</span>, removing support for remote content (images) and links masking. Clients MAY however support Base64 encoded images in MarkDown bodies. RECOMMENDED maximum size of Base64 encoded image source is 256KB, though clients MAY apply own limits.<a href="#section-9.4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="files-attachments">
<section id="section-9.4.3">
          <h4 id="name-files-attachments">
<a href="#section-9.4.3" class="section-number selfRef">9.4.3. </a><a href="#name-files-attachments" class="section-name selfRef">Files (Attachments)</a>
          </h4>
<p id="section-9.4.3-1">Mail/HTTPS allows including files into messages, commonly considered "attachments". While SMTP-based email embeds such files into multi-body messages, Mail/HTTPS transfers each file in a single one or multiple messages referencing the parent message containing the body.<a href="#section-9.4.3-1" class="pilcrow">¶</a></p>
<p id="section-9.4.3-2">While NOT RECOMMENDED, an only-files message is technically possible. Single file message is trivial. However, if the message contains multiple files, one of the resulting file-messages MUST become the parent message referenced by other file messages.<a href="#section-9.4.3-2" class="pilcrow">¶</a></p>
<p id="section-9.4.3-3">When a message is impracticaly large, it is split into parts which are transfered as own messages. The latter are re-assembled by readers' clients.<a href="#section-9.4.3-3" class="pilcrow">¶</a></p>
<p id="section-9.4.3-4">Splitting larger files into smaller messages brings benefits of parallel message transfers.<a href="#section-9.4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="size">
<section id="section-9.4.4">
          <h4 id="name-size">
<a href="#section-9.4.4" class="section-number selfRef">9.4.4. </a><a href="#name-size" class="section-name selfRef">Size</a>
          </h4>
<p id="section-9.4.4-1">Mail/HTTPS imposes no message size limitations. Any limitations are outcome of either author's own home agent service provider or reader's mail client. Considering the transient nature of messages on mail agents, the message size limit may be considerably high.<a href="#section-9.4.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4.4-2">Nevertheless, it is RECOMMENDED to keep individual messages under 100 Megabytes, effectively splitting larger messages into smaller messages. The process of splitting and reassembling SHOULD be unnoticeable to the end user. With such splitting, both authors and readers benefit from faster transfers due to the parellel transfers possibility.<a href="#section-9.4.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4.4-3">Unlike in SMTP-email, the size restrictions are not imposed by the remote reader's infrastructure. There is no guess work or trial and error when transferring large messages.<a href="#section-9.4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="headers">
<section id="section-9.5">
        <h3 id="name-headers">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-headers" class="section-name selfRef">Headers</a>
        </h3>
<p id="section-9.5-1">Mail/HTTPS uses standard HTTP headers for transmitting message information, separate from the message payload (content).<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<p id="section-9.5-2">HTTP headers of the message object play a critical role in providing information about the transfer, payload, and nature of messages within the Mail/HTTPS system. These headers are essential for various purposes, including determining the authenticity of messages, establishing access rights for readers, and understanding the overall nature of the messages being exchanged.<a href="#section-9.5-2" class="pilcrow">¶</a></p>
<p id="section-9.5-3">Confidential metadata is encapsulated within an encrypted object present within the headers. The object is encrypted using the same password used for encrypting the message content and is found in the "Message-Content-Headers" HTTP header, itself anonymously encrypted using readers public key.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
<p id="section-9.5-4">Reusing the same random password for encrypting both the content and metadata ensures consistency and simplifies the encryption process. It avoids the need for separate passwords and allows for efficient decryption of both the message content and metadata using the same shared key.<a href="#section-9.5-4" class="pilcrow">¶</a></p>
<p id="section-9.5-5">Headers keys MUST be treated as case insensitive both in envelope and within embedded content headers. The headers' values MUST be treated as case sensitive instead. The order of headers appearance is irrelevant, except for the calculation of envelope checksums, in which case the header values should be summed using the defined order in the attribute order of header 'Message-Checksum'.<a href="#section-9.5-5" class="pilcrow">¶</a></p>
<p id="section-9.5-6">HTTP specification does not impose headers size limitations, though many web servers and browsers do. Mail/HTTPS uses own servers and clients which SHOULD permit at least 512KB of headers both in requests and responses.<a href="#section-9.5-6" class="pilcrow">¶</a></p>
<div id="envelope">
<section id="section-9.5.1">
          <h4 id="name-envelope">
<a href="#section-9.5.1" class="section-number selfRef">9.5.1. </a><a href="#name-envelope" class="section-name selfRef">Envelope</a>
          </h4>
<p id="section-9.5.1-1">Envelope headers are directly provided as HTTP headers. In private messages, they do not reveal any information about the payload or the communicating party. Broadcast (public) messages on the other hand do not attempt to hide the content or the meta-data and instead focus on origin authentication.<a href="#section-9.5.1-1" class="pilcrow">¶</a></p>
<p id="section-9.5.1-2">Please note that the headers' keys are shown in camel case for readability purposes in the examples below. However, they are case insensitive.<a href="#section-9.5.1-2" class="pilcrow">¶</a></p>
<p id="section-9.5.1-3">These envelope headers are required and MUST be always present in all messages:<a href="#section-9.5.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1-4.1">
              <p id="section-9.5.1-4.1.1">Message-Id: The unique message identifier.<a href="#section-9.5.1-4.1.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-4.1.2">
<pre>
Message-Id: 1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d
</pre><a href="#section-9.5.1-4.1.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-9.5.1-4.2">
              <p id="section-9.5.1-4.2.1">Message-Headers: Base64 encoded data of either encrypted headers in private messages, or of plaintext headers in broadcast messages. Base64 data is given in attribute "value", while the attribute "algorithm" indicates the encryption algorithm used or value "none" if the data is not encrypted, only encoded.<a href="#section-9.5.1-4.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-4.2.2">
<pre>
Message-Headers: algorithm=xchacha20poly1305; value=2+WifyY8sHXYp2pLW...
</pre><a href="#section-9.5.1-4.2.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-9.5.1-4.3">
              <p id="section-9.5.1-4.3.1">Message-Checksum: Checksum information of these envelope headers. Attribute "algorithm" indicates the hashing algorithm used for calculating the checksum, defaulting to "sha256" <span>[<a href="#RFC6234" class="cite xref">RFC6234</a>]</span>. Since the order of headers may not be guaranteed during transfers, the attribute "order" lists the sequence of headers, separated by a colon ":" character. The sum is calculated on concatenated headers values without any separators in given order, and finally presented in attribute "value". Example:<a href="#section-9.5.1-4.3.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-4.3.2">
<pre>
Message-Checksum: algorithm=sha256; order=message-id:message-payload-cipher:message-access:message-headers; value=31edfd4d63fc0be44196...
</pre><a href="#section-9.5.1-4.3.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-9.5.1-4.4">
              <p id="section-9.5.1-4.4.1">Message-Signature: The checksum data previously calculated in the "Message-Checksum" as attribute "sum", is signed using author's private signing key and presented in the "Message-Signature". The attribute "algorithm" indicates signing algorithm used, while the resulting signature is presented in the attribute "value". To determine the right signing key during possible key rotations, attribute "key" holds the fingerprint of the public counterpart signing key. Example:<a href="#section-9.5.1-4.4.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-4.4.2">
<pre>
Message-Signature: algorithm=ed25519; value=rIIOtOnidYQ1V1DCvX739qOvAnaYRlv9; key=742e0d26134797bd
</pre><a href="#section-9.5.1-4.4.2" class="pilcrow">¶</a>
</div>
<p id="section-9.5.1-4.4.3">
Note that the signature is calculated on the checksum binary data represented hexadecimally, and not on the resulting hexadecimal string value.<a href="#section-9.5.1-4.4.3" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-9.5.1-5">The following envelope headers depend on the nature of the message:<a href="#section-9.5.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1-6.1">
              <p id="section-9.5.1-6.1.1">Message-Access: This header is present only on private messages and it distinguishes message from broadcasts. It contains a list of attribute groups containing connection identifiers (links), public keys and encrypted passwords for determining access rights. Each group identifies single reader. As standard HTTP header attributes, they are are separated using a semi column within the group while groups are coma separated. Each message MUST have at least one access group for the author. Each reader MUST have own access group. Each group MUST include the following attributes:<a href="#section-9.5.1-6.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1-6.1.2.1">"link": The connection identifier for the author and designated reader.<a href="#section-9.5.1-6.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-9.5.1-6.1.2.2">"access-key": Fingerprint of reader's public signing key. To retrieve the message, reader must identify via a signed nonce and a key. The fingerprint by the provided public signing key for the nonce must match the "access-key" in order for mail agent to permit message download.<a href="#section-9.5.1-6.1.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-9.5.1-6.1.2.3">"algorithm": The encryption algorithm used to encrypt the symmetric key. By default, Mail/HTTPS uses "curve25519xsalsa20poly1305".<a href="#section-9.5.1-6.1.2.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-9.5.1-6.1.2.4">"value": The encrypted symmetric key, Base64 encoded.<a href="#section-9.5.1-6.1.2.4" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-9.5.1-6.1.2.5">"key": Fingerprint of the public encryption key, counterpart of the private key used for encryption.<a href="#section-9.5.1-6.1.2.5" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-9.5.1-6.1.3">
Example:<a href="#section-9.5.1-6.1.3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-6.1.4">
<pre>
  Message-Access: link=b3185f54673a93d8cb0ed2688d17592cb04720418b33992acf992fcd602325d8; access-key=298b0eca1e6721d8; algorithm=curve25519xsalsa20poly1305; value=9bUJsKNLYAxe8+hRmP8UjzCZLJtsucsmrMr/4NkomASdOmOczAsoUX4K5pdz1LpizAdDpu7JsQTImWWISlp12Lm6rYHenKo1yhtW716P5YU=;  key=4ec9b6b0f558b9f4, link=ca1451339611240e5790b9724c4228f562b426e24882c2a20d3abde2bcb06c2e; access-key=030cc34c2336190b; algorithm=curve25519xsalsa20poly1305; value=KG+7A6QznRcO67DYm0iVM7PzuZE5VrRNWxP9eAxWlgyFChQXSvAB3WgnGk+jCFwHmry37aWxO8cKM0Mrmd5ETdAkY35inyvAisBL0FuWCpk=; key=ed43833649d1ccd5
</pre><a href="#section-9.5.1-6.1.4" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-9.5.1-6.2">
              <p id="section-9.5.1-6.2.1">Message-Encryption: The encryption information used to encrypt the payload. Present only on private messages. It MUST contain attribute "algorithm", identifying the encryption scheme used. If the algorithm is a stream cipher, attribute "chunk-size" SHOULD provide the used chunk size as in integer number. Example:<a href="#section-9.5.1-6.2.1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-9.5.1-6.2.2">
<pre>
  Message-Encryption: algorithm=secretstream_xchacha20poly1305; chunk-size=8192
  Message-Encryption: algorithm=xchacha20poly1305
</pre><a href="#section-9.5.1-6.2.2" class="pilcrow">¶</a>
</div>
</li>
            <li class="normal" id="section-9.5.1-6.3">Message-Stream: The public stream, tag or grouping of the message, a free-form value. May be assigned by the author to the message if the message is to be tied to specific stream. Only a single stream tag is permitted.<a href="#section-9.5.1-6.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.1-6.4">Message-Pinned: Presence of this header is reserved for broadcast messages and indicates that the message should be kept until unpinned. The header has no meaning in private messages. The only valid value is "Yes", otherwise the header is treated as not present. Mail agents MAY ignore this header.<a href="#section-9.5.1-6.4" class="pilcrow">¶</a>
</li>
          </ul>
<div id="http-content-length">
<section id="section-9.5.1.1">
            <h5 id="name-http-content-length">
<a href="#section-9.5.1.1" class="section-number selfRef">9.5.1.1. </a><a href="#name-http-content-length" class="section-name selfRef">HTTP Content-Length</a>
            </h5>
<p id="section-9.5.1.1-1">Standard HTTP Content-Length header SHOULD be used whenever possible to indicate the payload size that follows. Both agents and clients may use the content length to restrict the stream flow, or refuse the request altogether due to an irregular size.<a href="#section-9.5.1.1-1" class="pilcrow">¶</a></p>
<p id="section-9.5.1.1-2">Depending on the encryption algorithm used for streaming uploads, the exact content-length may not be known beforehand. Uploading clients MAY provide an estimated size as a maximum content length expected, based on the original content and a safe margin overhead.<a href="#section-9.5.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="content-headers">
<section id="section-9.5.1.2">
            <h5 id="name-content-headers">
<a href="#section-9.5.1.2" class="section-number selfRef">9.5.1.2. </a><a href="#name-content-headers" class="section-name selfRef">Content Headers</a>
            </h5>
<p id="section-9.5.1.2-1">Envelope contains content headers of private messages or encoded of broadcasts. In both cases, the content headers are contained in the envelope 'Message-Content-Headers' header.<a href="#section-9.5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-9.5.1.2-2">The following content headers are mandatory in all messages:<a href="#section-9.5.1.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1.2-3.1">Id: Message identifier, SHOULD match the envelope Message-ID unless the message is forwarded in which case it MAY differ.<a href="#section-9.5.1.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.2">Author: The address of the author as a valid Mail/HTTPS address.<a href="#section-9.5.1.2-3.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.3">Date: The authored-on date in ISO 8601 UTC format, for example "2023-10-24T19:04:31Z".<a href="#section-9.5.1.2-3.3" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.4">Size: The size in bytes of the raw content, whether text body or file.<a href="#section-9.5.1.2-3.4" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.5">Checksum: Checksum of the content, whether text body or file.<a href="#section-9.5.1.2-3.5" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.6">Subject: Plain text subject line for the message.<a href="#section-9.5.1.2-3.6" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.7">Subject-Id: Unique subject identifier; equals the message identifier of messages initiating new subjects. It is used by mail clients for grouping messages of a same topic.<a href="#section-9.5.1.2-3.7" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.5.1.2-3.8">Category: Categorization of the message (see below).<a href="#section-9.5.1.2-3.8" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-9.5.1.2-4">The following content headers depend on the nature of the message:<a href="#section-9.5.1.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1.2-5.1">
                <p id="section-9.5.1.2-5.1.1">Readers: The addresses of the readers, comma separated, used for expanding the Message-Access envelope header. MUST be present in private messages.<a href="#section-9.5.1.2-5.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1.2-5.1.2.1">Expanded addresses MUST BE displayed in parentheses following the original address.<a href="#section-9.5.1.2-5.1.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.1.2.2">Author's address SHOULD NOT be preset among readers. It is present in access links, but a reader role is implicit.<a href="#section-9.5.1.2-5.1.2.2" class="pilcrow">¶</a>
</li>
                </ul>
</li>
              <li class="normal" id="section-9.5.1.2-5.2">
                <p id="section-9.5.1.2-5.2.1">File: If the message payload is a file (attachment), the "File" header MUST be present describing the file. Following attributes are permitted:<a href="#section-9.5.1.2-5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1.2-5.2.2.1">"name": case sensitive file name, it SHOULD NOT include special or whitespace characters, but the final decision on permitted filenames rests with mail clients which MAY sanitize and rename file names.<a href="#section-9.5.1.2-5.2.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.2.2.2">"type": representing the MIME type of the file<a href="#section-9.5.1.2-5.2.2.2" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.2.2.3">"size": the file size in bytes. This attribute MAY be present but its use is NOT RECOMMENDED. The size value is redundant as the content header "Size" represents the same value.<a href="#section-9.5.1.2-5.2.2.3" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.2.2.4">"part": if the payload is a segment of a larger payload, the segment number and total number of segments are expected.<a href="#section-9.5.1.2-5.2.2.4" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.2.2.5">
                    <p id="section-9.5.1.2-5.2.2.5.1">"modified": the file's last modification date at origin in ISO 8601 UTC format. The modification date SHOULD be used to restore the file modification date upon transfer, whenever possible. When a message is separated in parts, any modification date present in any of the parts MAY be used.<a href="#section-9.5.1.2-5.2.2.5.1" class="pilcrow">¶</a></p>
<p id="section-9.5.1.2-5.2.2.5.2">
File: name=my_large_recording_02.mp3; type=audio/mp3; size=172556326; part=1/3; id=1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d; modified=2023-10-24T19:04:31Z<a href="#section-9.5.1.2-5.2.2.5.2" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="normal" id="section-9.5.1.2-5.3">
                <p id="section-9.5.1.2-5.3.1">Files: If the origin message includes multiple files, all those MUST be listed in the parent message only. The "Files" header gives a hint of how the original message was structured upon authoring as well how the message should be re-assembled upon retrieval. The header is very similar to the "File" attribute. Following optional attributes are mandatory and MUST be present:<a href="#section-9.5.1.2-5.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.1.2-5.3.2.1">"name": case sensitive file name, it SHOULD NOT include special or whitespace characters, but the final decision on permitted filenames rests with mail clients which MAY sanitize and rename file names.<a href="#section-9.5.1.2-5.3.2.1" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.3.2.2">"type": representing the MIME type of the file. The MIME type helps client represent the nature of the file.<a href="#section-9.5.1.2-5.3.2.2" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.3.2.3">"size": the file size in bytes.<a href="#section-9.5.1.2-5.3.2.3" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.3.2.4">"part": if the payload is a segment of a larger payload, the segment number and total number of segments are expected.<a href="#section-9.5.1.2-5.3.2.4" class="pilcrow">¶</a>
</li>
                  <li class="normal" id="section-9.5.1.2-5.3.2.5">
                    <p id="section-9.5.1.2-5.3.2.5.1">"id": the message id containing the file payload. Mail clients will use this id to check if the message is present in its entirety.<a href="#section-9.5.1.2-5.3.2.5.1" class="pilcrow">¶</a></p>
<p id="section-9.5.1.2-5.3.2.5.2">
Files: name=my_recording_01.mp3; type=audio/mp3; size=56321; id=1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d,
name=my_large_recording_02.mp3; type=audio/mp3; size=172556326; part=1/3; id=1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d;
name=my_large_recording_02.mp3; type=audio/mp3; size=172556326; part=2/3; id=1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d;
name=my_large_recording_02.mp3; type=audio/mp3; size=172556326; part=3/3; id=1a24e40aa77824272489324dc36d96c9a0a7d5792ee4467c7bee570d4205267d;<a href="#section-9.5.1.2-5.3.2.5.2" class="pilcrow">¶</a></p>
</li>
                </ul>
<p id="section-9.5.1.2-5.3.3">
It can be observed that the information of a given file is present both in the parent message in the "Files" header, as well in the message containing actual file payload, in the "File" header. This is intentional as dependent messages are often not retrieved at the exact same time. Each message MUST be able to describe the payload it caries.<a href="#section-9.5.1.2-5.3.3" class="pilcrow">¶</a></p>
</li>
              <li class="normal" id="section-9.5.1.2-5.4">Parent-Id: contains the Id of the parent message if the payload contained should be treated as an "attached" file and part of the parent message. The relation between messages CAN be re-established only if the related messages were all authored by the same author as the parent message and the parent references this message from its Files header.<a href="#section-9.5.1.2-5.4" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="categorization">
<section id="section-9.5.2">
          <h4 id="name-categorization">
<a href="#section-9.5.2" class="section-number selfRef">9.5.2. </a><a href="#name-categorization" class="section-name selfRef">Categorization</a>
          </h4>
<p id="section-9.5.2-1">The conventional approach to email treats all messages as equal, resulting in overloaded inboxes and the laborious task of sorting through them. Many users end up abandoning the effort and retaining all messages, which not only consumes unnecessary storage and contributes to a larger carbon footprint but also hinders an optimized user experience. Consequently, methods such as content detection have been employed, further increasing the processing power.<a href="#section-9.5.2-1" class="pilcrow">¶</a></p>
<p id="section-9.5.2-2">By pre-categorizing messages by authors, it becomes possible to enhance how mail clients display and handle these messages. Additionally, it enables better decision-making regarding whether or not to save them in archives.<a href="#section-9.5.2-2" class="pilcrow">¶</a></p>
<p id="section-9.5.2-3">We define standard categories for mail objects:<a href="#section-9.5.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5.2-4.1">"personal": Messages from the private circles that are likely to be saved for future reference.<a href="#section-9.5.2-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.2">"chat": Short, off-the-record messages that are typically not saved individually.<a href="#section-9.5.2-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.3">"transitory": TOTP, one time access links etc. These messages are not be saved by default.<a href="#section-9.5.2-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.4">"notification": Information of an event occurrence such as system alert, sensor information, security notification, parcel shipping status etc. These messages are not to be saved by default.<a href="#section-9.5.2-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.5">"transaction": Messages related to a private or commercial transaction, such as order confirmation, receipt, refund etc. These messages are valuable and are saved by default.<a href="#section-9.5.2-4.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.6">"promotion": Messages informing of new offerings, sales events etc. These messages are not to be saved by default.<a href="#section-9.5.2-4.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.7">"letter": Official communication from organizations, government as well anything that would have been sent as postal mail. These messages are usually valuable and are saved by default. While the term "letter" may evoke the idea of a PDF format, it's important to clarify that in this context, the message type does not specifically refer to PDFs. Instead, it pertains to plain text messages where the content is expected to be in the form of plain text within the message body. However, it is possible to include a PDF file as an additional message of type "file," which could be associated with the "letter" message. In such cases, the PDF file would appear as an attachment or related document, similar to how attachments are typically displayed in legacy email.<a href="#section-9.5.2-4.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.8">"file": Messages containing a single file of any file type. These messages are to be saved by default.<a href="#section-9.5.2-4.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.9">"informational": Messages that are announcements, commonly broadcast that cannot be classified under any other categories.<a href="#section-9.5.2-4.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.10">"pass": Messages containing a pass, such as as airplane tickets, theater tickets, invitations etc. The messages may be referenced by other messages containing pass files such as PDF, PKPASS etc.<a href="#section-9.5.2-4.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.11">"funds": This category serves as a placeholder for future developments and potential inclusion of such digital currency-related messages. It anticipates the possibility of incorporating messages that involve digital currency transactions, loyalty program points, or electronic cash in the future.<a href="#section-9.5.2-4.11" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.12">"encryption-key": Special messages containing a replacement private encryption key. These messages must be authored by the reader, duly encrypted and signed with current keys, and retrieved only from the user's own email agent. Email clients MUST refuse to retrieve remote messages of other authors of this type.<a href="#section-9.5.2-4.12" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-9.5.2-4.13">"signing-key": Special messages containing a replacement private signing key. These messages must be authored by the reader, duly encrypted and signed with current keys, and retrieved only from the user's own email agent. Email clients MUST refuse to retrieve remote messages of other authors of this type.<a href="#section-9.5.2-4.13" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="streams">
<section id="section-9.5.3">
          <h4 id="name-streams">
<a href="#section-9.5.3" class="section-number selfRef">9.5.3. </a><a href="#name-streams" class="section-name selfRef">Streams</a>
          </h4>
<p id="section-9.5.3-1">Some messages may have meaning only as a part of a particular grouping. Email/HTTPS offers streams for such grouping. Author may define private or public streams of messages, identified by a freely chosen stream tag. Any URL safe string may be used as a stream tag. Stream tags are considered case-insensitive.<a href="#section-9.5.3-1" class="pilcrow">¶</a></p>
<p id="section-9.5.3-2">Streams are not separated from regular private and broadcast messages. To list or retrieve stream messages, the stream MUST be explicitly requested. Readers' mail clients must keep track of streams subscriptions in their address books.<a href="#section-9.5.3-2" class="pilcrow">¶</a></p>
<p id="section-9.5.3-3">Individual streams are commonly prefixed with a tilde sign '~' to be identified as such, but the tilde sign SHALL NOT be considered part of the tag. Some examples of streams would be ~family_photos, ~announcements, ~releases, ~writing.<a href="#section-9.5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="no-reply">
<section id="section-9.5.4">
          <h4 id="name-no-reply">
<a href="#section-9.5.4" class="section-number selfRef">9.5.4. </a><a href="#name-no-reply" class="section-name selfRef">No Reply</a>
          </h4>
<p id="section-9.5.4-1">Just as in SMTP based email, unmonitored mailboxes have valid uses. In HTTPS/Mail, mailboxes with a present but empty encryption key in their profile are considered "no-reply" addresses.<a href="#section-9.5.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="public-links">
<section id="section-10">
      <h2 id="name-public-links">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-public-links" class="section-name selfRef">Public Links</a>
      </h2>
<p id="section-10-1">Connection links on the mail agent are anonymized contact identifiers that have multiple uses.<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">Should the user desire such setup, the connection links serve as filters for notifications, allowing only notifications from known connections to be accepted on the mail agent. It's important to note though that the mail agent itself is not capable of verifying the notifications authenticity since it cannot determine their origin. The verification process takes place in the mail client, where notifications are checked for authenticity and validity before being processed.<a href="#section-10-2" class="pilcrow">¶</a></p>
<p id="section-10-3">These links MAY be queried publicly for their existence only, without revealing any additional information. It is RECOMMENDED that such querying is enabled by default on mail agents as they do not leak any private information.<a href="#section-10-3" class="pilcrow">¶</a></p>
<div id="link-sniffing">
<section id="section-10.1">
        <h3 id="name-link-sniffing">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-link-sniffing" class="section-name selfRef">Link Sniffing</a>
        </h3>
<p id="section-10.1-1">Users can query other users for existence of the mutual link, effectively detecting if the communication is mutually permitted. Email clients SHOULD use this information for providing a better user experience.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">Should an author want to write a message for a given reader, it is useful to know if the reader has the author among own links. Before authoring a message, author's mail client SHOULD query and warn the author if the reader does not have the author in contact list. If the reader does not accept contact requests, it is pointless to even author. The mail client SHOULD refuse adding such reader to a message.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="contact-discovery">
<section id="section-10.2">
        <h3 id="name-contact-discovery">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-contact-discovery" class="section-name selfRef">Contact Discovery</a>
        </h3>
<p id="section-10.2-1">Social networking builds on connections of others. While email is the mother of all social networks, discovering connections was never possible. In Mail/HTTPS, users can use their address book to detect mutual connections with profiles of interest. These public lookups allow for introductions as they naturally happen offline, by inquiring an existing connection to make an introduction to another one through an introductory message.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">When a message arrives with additional readers which are not in own contact book, these SHOULD be highlighted and suggested by the mail client for adding to the address book.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="notifications">
<section id="section-11">
      <h2 id="name-notifications">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-notifications" class="section-name selfRef">Notifications</a>
      </h2>
<p id="section-11-1">When an author creates a message intended for specific readers and uploads it to own home agent, the readers SHOULD be informed of the new message's presence. This can be accomplished through two methods:<a href="#section-11-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11-2.1">Polling: In this approach, users periodically check all their contacts' mail agents to see if there are any updates or new messages waiting for them. They poll at regular intervals, either periodically or on-demand, to stay up-to-date with incoming messages. While this method is effective and doesn't rely on the reader's infrastructure, it may lead to some delays in message delivery if polling intervals are not frequent enough. Email clients have the freedom to implement their own polling logic according to their preferences.<a href="#section-11-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-11-2.2">Author Notifications: This method involves the author directly notifying the designated readers about the presence of the new message. When the author creates a message for specific readers, the author's mail client triggers notifications to inform the readers' mail agents about the message. Using notifications is more efficient and immediate, as readers receive notifications in real-time, reducing the need for constant polling and ensuring timely message discovery. However, it depends on the availability of the readers' mail agents.<a href="#section-11-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<div id="payload-1">
<section id="section-11.1">
        <h3 id="name-payload-2">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-payload-2" class="section-name selfRef">Payload</a>
        </h3>
<p id="section-11.1-1">Notifications are initiated from the Mail/HTTPS client of the author and sent directly to the mail agents of the readers.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">Each notification includes the author's address, which is encrypted anonymously using the reader's public encryption key. This encrypted address serves a dual purpose: it's used for identifying new contact requests and verifying the authenticity of the notification when retrieved by the reader's mail client.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
<p id="section-11.1-3">The notification call is publicly authenticated with the remote mail agent, requiring a signed nonce in the HTTP headers. However, this nonce is only used for verifying the signature locally. The mail agent itself is unable to independently confirm the authenticity of notifications because it lacks information about their origin.<a href="#section-11.1-3" class="pilcrow">¶</a></p>
<p id="section-11.1-4">If the reader configures their home agent to accept notifications exclusively from their own connection identifiers, the mail agent may decline notification requests, essentially also preventing the acceptance of new contact requests.<a href="#section-11.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="identifier">
<section id="section-11.2">
        <h3 id="name-identifier">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-identifier" class="section-name selfRef">Identifier</a>
        </h3>
<p id="section-11.2-1">Upon accepting a notification, mail agents are expected to assign a unique, local identifier to each notification. The notification identifier MUST be generated locally after the acceptance of the notification and cannot be part of the incoming notification. Identifiers help mail clients keep state of already seen notifications.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<p id="section-11.2-2">The notification identifier MUST be an alpha-numeric string of no more than 32 characters. The identifier may be a counter or generated random string and MUST be unique locally for each notification of a given link.<a href="#section-11.2-2" class="pilcrow">¶</a></p>
<p id="section-11.2-3">Overwriting an existing notification assigns a new identifier.<a href="#section-11.2-3" class="pilcrow">¶</a></p>
<p id="section-11.2-4">The identifier is expected to be returned in the list notifications private API call.<a href="#section-11.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lifetime-1">
<section id="section-11.3">
        <h3 id="name-lifetime-2">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-lifetime-2" class="section-name selfRef">Lifetime</a>
        </h3>
<p id="section-11.3-1">Notifications SHOULD be kept for at most 7 days (168 hours) upon being recieved by mail agents.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
<p id="section-11.3-2">Should an author repeat a notification, an existing notification SHOULD be overwritten and its lifetime reset on the agent. The new notification would have a new identifier which indicates mail clients the presence of new messages.<a href="#section-11.3-2" class="pilcrow">¶</a></p>
<p id="section-11.3-3">While the mail agents extend notifications lifetime, mail client SHOULD NOT override non-existing contacts' notifications with new ones for the same author. If an existing notification exists for a given author, the identifier SHOULD be updated, but not the date of the first notification.<a href="#section-11.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="verification">
<section id="section-11.4">
        <h3 id="name-verification">
<a href="#section-11.4" class="section-number selfRef">11.4. </a><a href="#name-verification" class="section-name selfRef">Verification</a>
        </h3>
<p id="section-11.4-1">The authenticity of notifications is not verified by mail agents and must be completed by mail clients upon retrieval.<a href="#section-11.4-1" class="pilcrow">¶</a></p>
<p id="section-11.4-2">Each notification MUST contain:<a href="#section-11.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.4-3.1">unique notification identifier<a href="#section-11.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-3.2">author's encrypted address as payload<a href="#section-11.4-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-3.3">author's signing fingerprint used to deliver the notification<a href="#section-11.4-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-11.4-4">The authenticity is verified by:<a href="#section-11.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.4-5.1">checking fingerprint match with readers' public keys (actual and previous)<a href="#section-11.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-5.2">decrypting the notification payload with the reader's private key, resulting into author's address<a href="#section-11.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-5.3">ensuring author's address is a valid email address<a href="#section-11.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-5.4">ensuring link matches author's and reader (local) address<a href="#section-11.4-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-11.4-5.5">retrieving author's profile and comparing signing fingerprint with the one of the actual or last public signing key<a href="#section-11.4-5.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-11.4-6">Should any step fail, the notification is to be considered bogus and MUST be ignored. Mail clients SHOULD mark and cache bogus notifications locally up to its maximum lifetime to avoid further re-checks of the same signing fingerprint.<a href="#section-11.4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="execution">
<section id="section-11.5">
        <h3 id="name-execution">
<a href="#section-11.5" class="section-number selfRef">11.5. </a><a href="#name-execution" class="section-name selfRef">Execution</a>
        </h3>
<p id="section-11.5-1">Mail clients MAY proceed to act upon verified notifications.<a href="#section-11.5-1" class="pilcrow">¶</a></p>
<p id="section-11.5-2">If the connection identifier is an existing contact, mail clients MAY immediately proceed to retrieving remote messages.<a href="#section-11.5-2" class="pilcrow">¶</a></p>
<p id="section-11.5-3">If the connection identifier is not an existing contact, mail clients MUST treat it as a contact request. Mail clients MUST NOT retrieve messages from non-existing contacts in automatic manner.<a href="#section-11.5-3" class="pilcrow">¶</a></p>
<p id="section-11.5-4">Mail clients MAY however allow "peeking" into messages based on notifications at request of local user (reader).<a href="#section-11.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="suppressions">
<section id="section-11.6">
        <h3 id="name-suppressions">
<a href="#section-11.6" class="section-number selfRef">11.6. </a><a href="#name-suppressions" class="section-name selfRef">Suppressions</a>
        </h3>
<p id="section-11.6-1">Mail agents MAY implement suppressions for selected links (connection identifiers). Notifying on a suppressed link would be refused, without determining existence of the link. Suppressions may be used for silencing contact requests from specific identities directly on the mail agent.<a href="#section-11.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="address-expansions">
<section id="section-12">
      <h2 id="name-address-expansions">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-address-expansions" class="section-name selfRef">Address Expansions</a>
      </h2>
<p id="section-12-1">In SMTP-email, messages are often automatically forwarded to other addresses or sent to virtual alias addresses which then distribute the message to multiple recipients. Such setups hide the final readers from the author, who may have disapproved of the message distribution. Moreover, automatic forwarding breaks email protections and increases likelihood of being rejected or silently dropped as spam.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">There are valid cases for aliasing/forwarding however:<a href="#section-12-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-12-3.1">The user may have changed address, and would like to receive messages on the new address.<a href="#section-12-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-12-3.2">While away, messages could be delegated to a responsible substitute, a common case in business.<a href="#section-12-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-12-3.3">A copy could always be desired to the business or family partner<a href="#section-12-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-12-3.4">An archives provider could receive a copy for keeping remote archives.<a href="#section-12-3.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-12-3.5">A group of responsible persons should receive a copy of the same message.<a href="#section-12-3.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-12-3.6">A poor man's mailing list, where the list of members (readers) is always contained in one address.<a href="#section-12-3.6" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-12-4">While SMTP-email forwarding happens on relays, Mail/HTTPS provides for similar result but directly within mail client by reading the address expansions from the address' public profile. This permits end-to-end encryption and full knowledge of the final readers by the author.<a href="#section-12-4" class="pilcrow">¶</a></p>
<div id="envelope-1">
<section id="section-12.1">
        <h3 id="name-envelope-2">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-envelope-2" class="section-name selfRef">Envelope</a>
        </h3>
<p id="section-12.1-1">Envelope MUST list all resulting readers after the address expansions. There MUST BE no traces in the envelope of any expansion.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="content-headers-1">
<section id="section-12.2">
        <h3 id="name-content-headers-2">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-content-headers-2" class="section-name selfRef">Content Headers</a>
        </h3>
<p id="section-12.2-1">The 'Readers' content header SHOULD document the address expansion by following the expanded address by a column and semi column separated list of expanded addresses. Example:<a href="#section-12.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-12.2-2">
<pre>
Readers: reader1@domain1.tld, reader2@domain2.tld, expanded.reader@domain3.tld:reader4@somewhereelse.tld;reader5@somewhereelse2.tld
</pre><a href="#section-12.2-2" class="pilcrow">¶</a>
</div>
<p id="section-12.2-3">Presence of the original expansion in content headers permits authored replies to re-evaluate the expansion based on actual settings. Expanded addresses SHOULD be distinguished in mail clients.<a href="#section-12.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="replies">
<section id="section-13">
      <h2 id="name-replies">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-replies" class="section-name selfRef">Replies</a>
      </h2>
<p id="section-13-1">In SMTP-email, Reply-To header is a technical detail and causes confusion. It causes disparity between what is assumed and what is actually happening. When a reply is made by a recipient, the assumption is often that the reply is made to the original author (sender), present in the 'From' header. The 'Reply-To' address requested by the original sender may easily be overlooked by the reader.<a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">Mail/HTTPS does not have support for Reply-To headers. Should a reply be required to another address, that address SHOULD be included in the original message as an additional reader. The obvious behavior SHOULD always be the assumed one.<a href="#section-13-2" class="pilcrow">¶</a></p>
<p id="section-13-3">Upon replying, the Subject-Id of the message being replied MUST be taken over as Subject-Id of the reply. The Subject line MAY be altered. Parent-Id MUST NOT be ever taken over in replies.<a href="#section-13-3" class="pilcrow">¶</a></p>
<div id="automatic-replies">
<section id="section-13.1">
        <h3 id="name-automatic-replies">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-automatic-replies" class="section-name selfRef">Automatic Replies</a>
        </h3>
<p id="section-13.1-1">In SMTP-email automatic replies such as vacation, out-of-office and e.g. ticket received are very common. However, they are workarounds that exist because of underlying conceptual issues:<a href="#section-13.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13.1-2.1">no recipient state information is available before sending; feedback is typically obtained only upon a full message loop. If the sender had the status information about the recipient, the sending decision as well the content may have been made differently.<a href="#section-13.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-13.1-2.2">no actual recipient delivery confirmation exists on the protocol level; SMTP DSNs <span>[<a href="#RFC3461" class="cite xref">RFC3461</a>]</span> are concerned with messages reaching recipient's infrastructure but not the actual reader.<a href="#section-13.1-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-13.1-3">Automatic replies by intermediating relays are not supported by design, as the reply SHOULD come from the end user.<a href="#section-13.1-3" class="pilcrow">¶</a></p>
<p id="section-13.1-4">Mail/HTTPS provides address status before sending to it. Should the address profile indicate that the user is away, the mail client SHOULD suggest delivery at a later time along with the away message from address profile. If an authored message however is picked up by the designated reader, the pickup is itself the confirmation of final delivery. In both cases, no automatic reply is necessary anymore.<a href="#section-13.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="api">
<section id="section-14">
      <h2 id="name-api">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-api" class="section-name selfRef">API</a>
      </h2>
<div id="authentication">
<section id="section-14.1">
        <h3 id="name-authentication">
<a href="#section-14.1" class="section-number selfRef">14.1. </a><a href="#name-authentication" class="section-name selfRef">Authentication</a>
        </h3>
<p id="section-14.1-1">Mail/HTTPS mandates authentication for accessing mail agents, both as an author or reader.
When authenticating as author, the home server permits uploading and controlling messages, retrieving notifications, account as well keys management. When authenticating as reader however, authenticated treader may list and retrieve designated messages, which also confirms pick-up by the reader's identity.<a href="#section-14.1-1" class="pilcrow">¶</a></p>
<p id="section-14.1-2">The same authentication method can be conveniently used to both home and remote agents as it bases itself on possession of valid private keys.<a href="#section-14.1-2" class="pilcrow">¶</a></p>
<p id="section-14.1-3">Mail/HTTPS authentication bases itself on HTTP authentication <span>[<a href="#RFC7235" class="cite xref">RFC7235</a>]</span>, with own pending scheme named 'SOTN', an acronym for Signed-One-Time-Nonce.<a href="#section-14.1-3" class="pilcrow">¶</a></p>
<div id="sotn-scheme">
<section id="section-14.1.1">
          <h4 id="name-sotn-scheme">
<a href="#section-14.1.1" class="section-number selfRef">14.1.1. </a><a href="#name-sotn-scheme" class="section-name selfRef">SOTN Scheme</a>
          </h4>
<p id="section-14.1.1-1">The SOTN authenticating scheme expects three values to be transferred in the 'Authorization' header:<a href="#section-14.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.1.1-2.1">A random nonce, as field 'nonce', generated locally in the mail client. The nonce is a random string of no less than 32 ASCII characters. The nonce may not repeat for at least 24 hours with the same service.<a href="#section-14.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-2.2">The signing algorithm as field 'algorithm', consistent with the Mail/HTTPS signing algorithms.<a href="#section-14.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-2.3">Signature of the nonce as field 'signature', using user's private signing key. Unlike the Mail/HTTPS signatures, the SOTN signature does not include embedded algorithm and cipher as these are provided as separate fields.<a href="#section-14.1.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-2.4">The public signing key of the user as field 'key', needed for verifying the signature. The public key MUST be simple Base64 encoded with padding.<a href="#section-14.1.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-14.1.1-3">The advantage of the SOTN scheme is in the lack of passwords, and the use of signed nonces over HTTPS which provides robust protection against both man-in-the-middle and replay attacks.<a href="#section-14.1.1-3" class="pilcrow">¶</a></p>
<p id="section-14.1.1-4">Upon authentication:<a href="#section-14.1.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.1.1-5.1">The service being authenticated checks that the provided nonce hasn't been used previously within the past 24 hours.<a href="#section-14.1.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-5.2">If the service being authenticated is home agent, it verifies whether the public key belongs to the user specified in the URL parameters. This verification SHOULD be made before verifying the authenticity of the signature.<a href="#section-14.1.1-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-5.3">If the service being authenticated is a remote mail agent, fingerprint of the public key is derived and compared to the readers list of pending messages. This verification SHOULD be made before verifying the authenticity of the signature.<a href="#section-14.1.1-5.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.1.1-5.4">Finally, the service being authenticated verifies the signature of the nonce using the provided public key.<a href="#section-14.1.1-5.4" class="pilcrow">¶</a>
</li>
          </ul>
<div id="example-1">
<section id="section-14.1.1.1">
            <h5 id="name-example-2">
<a href="#section-14.1.1.1" class="section-number selfRef">14.1.1.1. </a><a href="#name-example-2" class="section-name selfRef">Example</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-14.1.1.1-1">
<pre>
Authorization: SOTN
  nonce="7ypf/xlj9XXwfDPEoM4URrv/xwf94BcCAzFZH4GiTo0v",
  algorithm="ed25519",
  signature="pWHxd1/jCwkO5Ao5+sc+xDI01DWER2VAYBKCDEK/LgPBBwohiAcBENmy32Dhj0sqCAuME87couIue5dTF1b4AEUyg",
  key="ZjoCijxLNI2ts3NgQKNyxNR3E+gROmyEFsI8YUGJGZs="
</pre><a href="#section-14.1.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="public-api">
<section id="section-14.2">
        <h3 id="name-public-api">
<a href="#section-14.2" class="section-number selfRef">14.2. </a><a href="#name-public-api" class="section-name selfRef">Public API</a>
        </h3>
<p id="section-14.2-1">In Mail/HTTPS, mail agents serve a public API primarily for storing notifications and forwarding messages.<a href="#section-14.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2-2">The hostname of the mail agent is determined by the well-known scheme described previously in the mail agent discovery part of this document.<a href="#section-14.2-2" class="pilcrow">¶</a></p>
<div id="discovery-1">
<section id="section-14.2.1">
          <h4 id="name-discovery-2">
<a href="#section-14.2.1" class="section-number selfRef">14.2.1. </a><a href="#name-discovery-2" class="section-name selfRef">Discovery</a>
          </h4>
<p id="section-14.2.1-1">Determining if a mail agent is responsible for a particular domain or address is useful for selecting mail agents as well supporting provisioning new accounts.<a href="#section-14.2.1-1" class="pilcrow">¶</a></p>
<div id="domain">
<section id="section-14.2.1.1">
            <h5 id="name-domain">
<a href="#section-14.2.1.1" class="section-number selfRef">14.2.1.1. </a><a href="#name-domain" class="section-name selfRef">Domain</a>
            </h5>
<p id="section-14.2.1.1-1">To determine existence of a HOST_PART of a given address LOCAL_PART@HOST_PART on a determined mail agent MAIL_AGENT_HOSTNAME, a HEAD or GET request SHOULD be made to the following URI:<a href="#section-14.2.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.1.1-2">
<pre>
HTTPS HEAD https://MAIL_AGENT_HOSTNAME/mail/HOST_PART
HTTPS GET  https://MAIL_AGENT_HOSTNAME/mail/HOST_PART
</pre><a href="#section-14.2.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.1.1-3">An HTTP 200 status response indicates presence of the address while HTTP 404 status its absence.<a href="#section-14.2.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="address-1">
<section id="section-14.2.1.2">
            <h5 id="name-address-2">
<a href="#section-14.2.1.2" class="section-number selfRef">14.2.1.2. </a><a href="#name-address-2" class="section-name selfRef">Address</a>
            </h5>
<p id="section-14.2.1.2-1">To determine existence of a given address LOCAL_PART@HOST_PART on a determined mail agent MAIL_AGENT_HOSTNAME, a HEAD request SHOULD be made to the following URI:<a href="#section-14.2.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.1.2-2">
<pre>
HTTPS HEAD https://MAIL_AGENT_HOSTNAME/mail/HOST_PART/LOCAL_PART
</pre><a href="#section-14.2.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.1.2-3">If the profile owner permits last-access-tracking via own profile attribute "Last-Seen-Public", GET request to the same URI SHOULD return the last access time of the profile owner, as ISO 8601 UTC timestamp.<a href="#section-14.2.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.1.2-4">
<pre>
HTTPS GET  https://MAIL_AGENT_HOSTNAME/mail/HOST_PART/LOCAL_PART
</pre><a href="#section-14.2.1.2-4" class="pilcrow">¶</a>
</div>
<p id="section-14.2.1.2-5">An HTTP 200 status response indicates presence of the address while HTTP 404 status its absence.<a href="#section-14.2.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="provisioning">
<section id="section-14.2.2">
          <h4 id="name-provisioning">
<a href="#section-14.2.2" class="section-number selfRef">14.2.2. </a><a href="#name-provisioning" class="section-name selfRef">Provisioning</a>
          </h4>
<p id="section-14.2.2-1">Mail agents MAY permit registering of new accounts publicly on their selection of domains. If permitted, use of the following simple generic account provisioning API is RECOMMENDED as it would permit direct provisioning from mail clients.<a href="#section-14.2.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2.2-2">Abuse prevention mechanisms are beyond the scope of this document, but mail agents would typically restrict provisioning via Turing tests or rate limits based on IP addresses for example.<a href="#section-14.2.2-2" class="pilcrow">¶</a></p>
<div id="create">
<section id="section-14.2.2.1">
            <h5 id="name-create">
<a href="#section-14.2.2.1" class="section-number selfRef">14.2.2.1. </a><a href="#name-create" class="section-name selfRef">Create</a>
            </h5>
<p id="section-14.2.2.1-1">To provision a new account on a selected mail agent, the mail client MUST generate encryption and signing key pairs locally.<a href="#section-14.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-14.2.2.1-2">Using the generated keys, the signing key in particular, the mail client SHOULD post profile data of the account being provisioned with address LOCAL_PART@HOST_PART in an authenticated request to URI:<a href="#section-14.2.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.2.1-3">
<pre>
HTTPS POST /account/HOST_PART/LOCAL_PART
</pre><a href="#section-14.2.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-14.2.2.1-4">The Signing-Key profile attribute is required and MUST match the authentication public signing key as a proof of profile and private key ownership. While the Signing-Key is the only required profile attribute, mail clients will typically provide with a more complete profile information, including Name, Encryption-Key etc.<a href="#section-14.2.2.1-4" class="pilcrow">¶</a></p>
<p id="section-14.2.2.1-5">If an account with existing address exists already on the mail agent, an HTTP error status of 409 Conflict is expected. A successful provisioning returns HTTP 200 status code with an empty body.<a href="#section-14.2.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="profile">
<section id="section-14.2.3">
          <h4 id="name-profile">
<a href="#section-14.2.3" class="section-number selfRef">14.2.3. </a><a href="#name-profile" class="section-name selfRef">Profile</a>
          </h4>
<p id="section-14.2.3-1">The user's profile is served by the user's mail agents. The profile MUST be made available over HTTPS for public GET requests requiring no authentication.<a href="#section-14.2.3-1" class="pilcrow">¶</a></p>
<p id="section-14.2.3-2">For a given address LOCAL_PART@HOST_PART, the profile is expected at the path:<a href="#section-14.2.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.3-3">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/profile
</pre><a href="#section-14.2.3-3" class="pilcrow">¶</a>
</div>
<p id="section-14.2.3-4">Common HTTP status responses apply. The plaintext response body is expected only with a HTTP 200 status.<a href="#section-14.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="profile-image-1">
<section id="section-14.2.4">
          <h4 id="name-profile-image-2">
<a href="#section-14.2.4" class="section-number selfRef">14.2.4. </a><a href="#name-profile-image-2" class="section-name selfRef">Profile Image</a>
          </h4>
<p id="section-14.2.4-1">The profile image MUST be made available over HTTPS for public GET requests requiring no authentication.<a href="#section-14.2.4-1" class="pilcrow">¶</a></p>
<p id="section-14.2.4-2">For a given address LOCAL_PART@HOST_PART, the profile image is expected at the path:<a href="#section-14.2.4-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.4-3">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/image
</pre><a href="#section-14.2.4-3" class="pilcrow">¶</a>
</div>
<p id="section-14.2.4-4">Common HTTP status responses apply. The binary image response body is expected only with a HTTP 200 status.<a href="#section-14.2.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="links">
<section id="section-14.2.5">
          <h4 id="name-links">
<a href="#section-14.2.5" class="section-number selfRef">14.2.5. </a><a href="#name-links" class="section-name selfRef">Links</a>
          </h4>
<p id="section-14.2.5-1">Any Mail/HTTPS may query any LOCAL_PART@HOST_PART user's mail agent for the existence of connection identifier of a given address QUERY_LOCAL_PART@QUERY_HOST_PART. The connection identifier LINK is derived from two addresses (LOCAL_PART@HOST_PART and QUERY_LOCAL_PART@QUERY_HOST_PART).<a href="#section-14.2.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.5-2">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/link/LINK
</pre><a href="#section-14.2.5-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.5-3">The contact querying API MUST NOT require authentication. The mail agent should respond either with HTTP 200 Ok status if the link exists, or HTTP 404 Not found status if the link does not exist or the mail agent user does not consent to public lookups.<a href="#section-14.2.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notifications-1">
<section id="section-14.2.6">
          <h4 id="name-notifications-2">
<a href="#section-14.2.6" class="section-number selfRef">14.2.6. </a><a href="#name-notifications-2" class="section-name selfRef">Notifications</a>
          </h4>
<p id="section-14.2.6-1">Once an author makes a message available to readers, the author is expected to notify readers' mail agents of the presence of new messages.<a href="#section-14.2.6-1" class="pilcrow">¶</a></p>
<p id="section-14.2.6-2">The notifications MUST be made available over HTTPS PUT requests requiring nonce (SOTN) authentication. The payload of the request is the address of the notifier, encrypted anonymously using the reader's public encryption key, as described previously in asymmetric ciphers part of this document.<a href="#section-14.2.6-2" class="pilcrow">¶</a></p>
<p id="section-14.2.6-3">Mail agent of the user being notified does not have enough data to verify the notification request and should accept the request even if unverified. The verification always happens locally on mail clients using actual profile data.<a href="#section-14.2.6-3" class="pilcrow">¶</a></p>
<p id="section-14.2.6-4">For a given reader's address of LOCAL_PART@HOST_PART and connection identifier LINK between notifier (author) and reader, the notify request is to be made at path:<a href="#section-14.2.6-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.6-5">
<pre>
HTTPS PUT /mail/HOST_PART/LOCAL_PART/link/LINK/notifications
</pre><a href="#section-14.2.6-5" class="pilcrow">¶</a>
</div>
<p id="section-14.2.6-6">Response body is always ignored.<a href="#section-14.2.6-6" class="pilcrow">¶</a></p>
<p id="section-14.2.6-7">Accepted notify requests are confirmed with a HTTP 201 Created status.<a href="#section-14.2.6-7" class="pilcrow">¶</a></p>
<p id="section-14.2.6-8">Repeated requests for the same link, which exists in the reader's links, SHOULD extend the lifetime of the initial notification just as if the previous notification did not exist. Such repeated requests are confirmed with HTTP 208 Already Reported status.<a href="#section-14.2.6-8" class="pilcrow">¶</a></p>
<p id="section-14.2.6-9">Repeated requests for non-existing links SHOULD NOT extend the lifetime of the initial notification.<a href="#section-14.2.6-9" class="pilcrow">¶</a></p>
<p id="section-14.2.6-10">Notifications past their lifetime are silently dropped on the mail agent.<a href="#section-14.2.6-10" class="pilcrow">¶</a></p>
<p id="section-14.2.6-11">If the reader does not accept public contact requests and the connection identifier (link) is not known to the reader, the home agent MUST return HTTP 403 Forbidden status.<a href="#section-14.2.6-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="messages">
<section id="section-14.2.7">
          <h4 id="name-messages">
<a href="#section-14.2.7" class="section-number selfRef">14.2.7. </a><a href="#name-messages" class="section-name selfRef">Messages</a>
          </h4>
<p id="section-14.2.7-1">Mail/HTTPS messages API is stateless. The responsibility of keeping state and not re-downloading already retrieved messages is shifted completely to the mail clients.<a href="#section-14.2.7-1" class="pilcrow">¶</a></p>
<div id="private-messages-1">
<section id="section-14.2.7.1">
            <h5 id="name-private-messages-2">
<a href="#section-14.2.7.1" class="section-number selfRef">14.2.7.1. </a><a href="#name-private-messages-2" class="section-name selfRef">Private Messages</a>
            </h5>
<p id="section-14.2.7.1-1">After the reader acts upon the notification, its client is expected to connect to the author's mail agent to list and retrieve the private messages. All requests to private messages MUST be authenticated.<a href="#section-14.2.7.1-1" class="pilcrow">¶</a></p>
<div id="list">
<section id="section-14.2.7.1.1">
              <h6 id="name-list">
<a href="#section-14.2.7.1.1" class="section-number selfRef">14.2.7.1.1. </a><a href="#name-list" class="section-name selfRef">List</a>
              </h6>
<p id="section-14.2.7.1.1-1">For a given author's address of LOCAL_PART@HOST_PART, and connection identifier LINK between author and reader, the reader may request a list of available messages at the path:<a href="#section-14.2.7.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.1.1-2">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/link/LINK/messages
</pre><a href="#section-14.2.7.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.1.1-3">If the reader is observing a particular stream of the author identified by stream name STREAM, the available messages are listed at the path:<a href="#section-14.2.7.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.1.1-4">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/link/LINK/streams/STREAM/messages
</pre><a href="#section-14.2.7.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.1.1-5">Common HTTP status responses apply. The plaintext response body is expected only with a HTTP 200 status, as a list
of message identifiers, each identifier on its own line.<a href="#section-14.2.7.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retrieve">
<section id="section-14.2.7.1.2">
              <h6 id="name-retrieve">
<a href="#section-14.2.7.1.2" class="section-number selfRef">14.2.7.1.2. </a><a href="#name-retrieve" class="section-name selfRef">Retrieve</a>
              </h6>
<p id="section-14.2.7.1.2-1">Each message identifier MESSAGE_ID, obtained previously through list messages command, can be used for requesting the messages with that identifier.<a href="#section-14.2.7.1.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2.7.1.2-2">Once the list of identifiers of private messages from author LOCAL_PART@HOST_PART available for a specific connection identifier LINK is obtained, each of the message identifiers MESSAGE_ID can be used for retrieving the relevant message from a path:<a href="#section-14.2.7.1.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.1.2-3">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/link/LINK/messages/MESSAGE_ID
</pre><a href="#section-14.2.7.1.2-3" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.1.2-4">Common HTTP status responses apply.<a href="#section-14.2.7.1.2-4" class="pilcrow">¶</a></p>
<p id="section-14.2.7.1.2-5">In a successful HTTP request with a HTTP 200 status, HTTP response headers contain reserved Mail/HTTPS headers and the response body contains the message payload.<a href="#section-14.2.7.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="broadcast-messages">
<section id="section-14.2.7.2">
            <h5 id="name-broadcast-messages">
<a href="#section-14.2.7.2" class="section-number selfRef">14.2.7.2. </a><a href="#name-broadcast-messages" class="section-name selfRef">Broadcast Messages</a>
            </h5>
<p id="section-14.2.7.2-1">Broadcast messages are messages without specific readers. As such they are not encrypted but only signed.<a href="#section-14.2.7.2-1" class="pilcrow">¶</a></p>
<p id="section-14.2.7.2-2">While author may send out notifications to all contacts, but typically broadcast messages are retrieved by readers through periodic polling.<a href="#section-14.2.7.2-2" class="pilcrow">¶</a></p>
<p id="section-14.2.7.2-3">Requests for listing and retrieving broadcast messages MAY NOT require authentication.<a href="#section-14.2.7.2-3" class="pilcrow">¶</a></p>
<div id="list-1">
<section id="section-14.2.7.2.1">
              <h6 id="name-list-2">
<a href="#section-14.2.7.2.1" class="section-number selfRef">14.2.7.2.1. </a><a href="#name-list-2" class="section-name selfRef">List</a>
              </h6>
<p id="section-14.2.7.2.1-1">For a given author's address of LOCAL_PART@HOST_PART, the reader may request a list of available broadcast messages at the path:<a href="#section-14.2.7.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.2.1-2">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/messages
</pre><a href="#section-14.2.7.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.2.1-3">If the reader is observing a particular stream of the author identified by stream name STREAM, the available messages are listed at the path:<a href="#section-14.2.7.2.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.2.1-4">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/streams/STREAM/messages
</pre><a href="#section-14.2.7.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.2.1-5">Common HTTP status responses apply. The plaintext response body is expected only with a HTTP 200 status, as a list
of message identifiers, each identifier on its own line.<a href="#section-14.2.7.2.1-5" class="pilcrow">¶</a></p>
<p id="section-14.2.7.2.1-6">It is important that mail clients preserve state of already retrieved messages so that repeated retrieval of same user does not result in duplicated messages. The mail agents are stateless and do not keep state of messages already retrieved. The mail agent vault may be used for caching such data though.<a href="#section-14.2.7.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retrieve-1">
<section id="section-14.2.7.2.2">
              <h6 id="name-retrieve-2">
<a href="#section-14.2.7.2.2" class="section-number selfRef">14.2.7.2.2. </a><a href="#name-retrieve-2" class="section-name selfRef">Retrieve</a>
              </h6>
<p id="section-14.2.7.2.2-1">For a given author's address of LOCAL_PART@HOST_PART, and previously obtained message identifier MESSAGE_ID, the reader may retrieve the relevant broadcast messages at the path:<a href="#section-14.2.7.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.2.7.2.2-2">
<pre>
HTTPS GET /mail/HOST_PART/LOCAL_PART/messages/MESSAGE_ID
</pre><a href="#section-14.2.7.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-14.2.7.2.2-3">Common HTTP status responses apply.<a href="#section-14.2.7.2.2-3" class="pilcrow">¶</a></p>
<p id="section-14.2.7.2.2-4">In a successful HTTP request with a HTTP 200 status, HTTP response headers contain reserved Mail/HTTPS headers and the response body contains the message payload.<a href="#section-14.2.7.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="private-api">
<section id="section-14.3">
        <h3 id="name-private-api">
<a href="#section-14.3" class="section-number selfRef">14.3. </a><a href="#name-private-api" class="section-name selfRef">Private API</a>
        </h3>
<p id="section-14.3-1">While the public mail agent API defines interoperability between clients and mail agents of contacts, the private API defines a universal mail clients communication with home mail agents.<a href="#section-14.3-1" class="pilcrow">¶</a></p>
<p id="section-14.3-2">All private mail API requests are under the path /home and MUST be authenticated. In the following examples, it is assumed that the user's address is LOCAL_PART@HOST_PART.<a href="#section-14.3-2" class="pilcrow">¶</a></p>
<div id="authenticated-discovery">
<section id="section-14.3.1">
          <h4 id="name-authenticated-discovery">
<a href="#section-14.3.1" class="section-number selfRef">14.3.1. </a><a href="#name-authenticated-discovery" class="section-name selfRef">Authenticated Discovery</a>
          </h4>
<p id="section-14.3.1-1">A common requirement in mail clients is to query authentication before permitting access. In the case of Mail/HTTPS, each private API call is authenticated and can be used to triage authentication. The authentication consists in comparing the local private keys to the public keys on the mail agent via the SOTN authentication scheme as well ensuring the user is present and handled by the queried mail agent.<a href="#section-14.3.1-1" class="pilcrow">¶</a></p>
<p id="section-14.3.1-2">A generic authentication discovery endpoint MAY be present at the URI below, returning no body in response.<a href="#section-14.3.1-2" class="pilcrow">¶</a></p>
<div id="discovery-2">
<section id="section-14.3.1.1">
            <h5 id="name-discovery-3">
<a href="#section-14.3.1.1" class="section-number selfRef">14.3.1.1. </a><a href="#name-discovery-3" class="section-name selfRef">Discovery</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-14.3.1.1-1">
<pre>
HTTPS HEAD /home/HOST_PART/LOCAL_PART
</pre><a href="#section-14.3.1.1-1" class="pilcrow">¶</a>
</div>
<p id="section-14.3.1.1-2">HTTP 200 status response represents successful authentication. In case multiple mail agents are used, at least one MUST authenticate in order for authentication to be considered successful in mail clients.<a href="#section-14.3.1.1-2" class="pilcrow">¶</a></p>
<p id="section-14.3.1.1-3">Failing mail agents MUST be reported to the user by mail clients.<a href="#section-14.3.1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="notifications-2">
<section id="section-14.3.2">
          <h4 id="name-notifications-3">
<a href="#section-14.3.2" class="section-number selfRef">14.3.2. </a><a href="#name-notifications-3" class="section-name selfRef">Notifications</a>
          </h4>
<p id="section-14.3.2-1">The private notifications API lists received third party notifications.<a href="#section-14.3.2-1" class="pilcrow">¶</a></p>
<p id="section-14.3.2-2">Each notification is listed on its own line as:<a href="#section-14.3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14.3.2-3.1">unique notification identifier, provided by the mail agent<a href="#section-14.3.2-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.3.2-3.2">the payload sent by authors, containing encrypted author address;<a href="#section-14.3.2-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-14.3.2-3.3">fingerprint of author's public signing key, used for delivering the notification.<a href="#section-14.3.2-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-14.3.2-4">Retrieved notifications MUST be verified before being considered valid.<a href="#section-14.3.2-4" class="pilcrow">¶</a></p>
<p id="section-14.3.2-5">Email agents are responsible for caching notifications locally and ensuring same notifications are not repeatedly executed by clients.<a href="#section-14.3.2-5" class="pilcrow">¶</a></p>
<div id="list-2">
<section id="section-14.3.2.1">
            <h5 id="name-list-3">
<a href="#section-14.3.2.1" class="section-number selfRef">14.3.2.1. </a><a href="#name-list-3" class="section-name selfRef">List</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-14.3.2.1-1">
<pre>
HTTPS GET /home/HOST_PART/LOCAL_PART/notifications
</pre><a href="#section-14.3.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="messages-1">
<section id="section-14.3.3">
          <h4 id="name-messages-2">
<a href="#section-14.3.3" class="section-number selfRef">14.3.3. </a><a href="#name-messages-2" class="section-name selfRef">Messages</a>
          </h4>
<div id="list-3">
<section id="section-14.3.3.1">
            <h5 id="name-list-4">
<a href="#section-14.3.3.1" class="section-number selfRef">14.3.3.1. </a><a href="#name-list-4" class="section-name selfRef">List</a>
            </h5>
<p id="section-14.3.3.1-1">Unlike the public counterpart, the messages list API call lists authored messages, awaiting pickup on the mail agent.<a href="#section-14.3.3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.3.1-2">
<pre>
HTTPS GET /home/HOST_PART/LOCAL_PART/messages
</pre><a href="#section-14.3.3.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="status">
<section id="section-14.3.3.2">
            <h5 id="name-status">
<a href="#section-14.3.3.2" class="section-number selfRef">14.3.3.2. </a><a href="#name-status" class="section-name selfRef">Status</a>
            </h5>
<p id="section-14.3.3.2-1">The delivery status of messages is kept on mail agents. While the 'list' call lists only active messages, the 'status' SHOULD keep information on both active and recent reader pickups. It is RECOMMENDED that mail agents keep 30 day's worth of delivery history. The delivery history SHOULD be however no less than 14 days.<a href="#section-14.3.3.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.3.2-2">
<pre>
HTTPS GET /home/HOST_PART/LOCAL_PART/messages/MID
</pre><a href="#section-14.3.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-14.3.3.2-3">The response is a list of links and access timestamps, separated by a comma, each on own line.<a href="#section-14.3.3.2-3" class="pilcrow">¶</a></p>
<p id="section-14.3.3.2-4">It is important to note that it is pointless to store the delivery information for longer periods due to keys rotation.<a href="#section-14.3.3.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="upload">
<section id="section-14.3.3.3">
            <h5 id="name-upload">
<a href="#section-14.3.3.3" class="section-number selfRef">14.3.3.3. </a><a href="#name-upload" class="section-name selfRef">Upload</a>
            </h5>
<p id="section-14.3.3.3-1">Uploading call makes the authored message available to readers.<a href="#section-14.3.3.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.3.3-2">
<pre>
HTTPS POST /home/HOST_PART/LOCAL_PART/messages
</pre><a href="#section-14.3.3.3-2" class="pilcrow">¶</a>
</div>
<p id="section-14.3.3.3-3">If the message Id being uploaded already exists on the mail agent, the call is rejected with status 409 Conflict. Updates to already uploaded messages are not permitted. Messages may however be revoked by deleting them using the delete request.<a href="#section-14.3.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="delete">
<section id="section-14.3.3.4">
            <h5 id="name-delete">
<a href="#section-14.3.3.4" class="section-number selfRef">14.3.3.4. </a><a href="#name-delete" class="section-name selfRef">Delete</a>
            </h5>
<p id="section-14.3.3.4-1">The delete request removes the message with id MID from the mail agent and makes it unavailable from reading by readers, even after they have been notified.<a href="#section-14.3.3.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.3.4-2">
<pre>
HTTPS POST /home/HOST_PART/LOCAL_PART/messages/MID
</pre><a href="#section-14.3.3.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="profile-1">
<section id="section-14.3.4">
          <h4 id="name-profile-2">
<a href="#section-14.3.4" class="section-number selfRef">14.3.4. </a><a href="#name-profile-2" class="section-name selfRef">Profile</a>
          </h4>
<p id="section-14.3.4-1">User profile is stored and served as a simple textual file on the mail agent. Management of all its contents are left to the mail clients. The mail agent SHOULD refuse to update a profile with invalid or oversized content.<a href="#section-14.3.4-1" class="pilcrow">¶</a></p>
<div id="update">
<section id="section-14.3.4.1">
            <h5 id="name-update">
<a href="#section-14.3.4.1" class="section-number selfRef">14.3.4.1. </a><a href="#name-update" class="section-name selfRef">Update</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-14.3.4.1-1">
<pre>
HTTPS PUT /home/HOST_PART/LOCAL_PART/profile
</pre><a href="#section-14.3.4.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="profile-image-2">
<section id="section-14.3.5">
          <h4 id="name-profile-image-3">
<a href="#section-14.3.5" class="section-number selfRef">14.3.5. </a><a href="#name-profile-image-3" class="section-name selfRef">Profile Image</a>
          </h4>
<p id="section-14.3.5-1">User profile image is stored and served as an image file on the mail agent, without any image conversions. The mail agent SHOULD refuse to update a profile image with invalid or oversized content.<a href="#section-14.3.5-1" class="pilcrow">¶</a></p>
<div id="update-1">
<section id="section-14.3.5.1">
            <h5 id="name-update-2">
<a href="#section-14.3.5.1" class="section-number selfRef">14.3.5.1. </a><a href="#name-update-2" class="section-name selfRef">Update</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-14.3.5.1-1">
<pre>
HTTPS PUT /home/HOST_PART/LOCAL_PART/image
</pre><a href="#section-14.3.5.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="links-1">
<section id="section-14.3.6">
          <h4 id="name-links-2">
<a href="#section-14.3.6" class="section-number selfRef">14.3.6. </a><a href="#name-links-2" class="section-name selfRef">Links</a>
          </h4>
<p id="section-14.3.6-1">Links or connection identifiers MAY be stored on mail agents to facilitate notification restrictions and contact discovery. Neither is required by Mail/HTTPS.<a href="#section-14.3.6-1" class="pilcrow">¶</a></p>
<p id="section-14.3.6-2">Links MUST be handled individually, one by one.<a href="#section-14.3.6-2" class="pilcrow">¶</a></p>
<div id="list-4">
<section id="section-14.3.6.1">
            <h5 id="name-list-5">
<a href="#section-14.3.6.1" class="section-number selfRef">14.3.6.1. </a><a href="#name-list-5" class="section-name selfRef">List</a>
            </h5>
<p id="section-14.3.6.1-1">The list call retrieves all user's connection identifiers.<a href="#section-14.3.6.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.6.1-2">
<pre>
HTTPS GET /home/HOST_PART/LOCAL_PART/links
</pre><a href="#section-14.3.6.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="store">
<section id="section-14.3.6.2">
            <h5 id="name-store">
<a href="#section-14.3.6.2" class="section-number selfRef">14.3.6.2. </a><a href="#name-store" class="section-name selfRef">Store</a>
            </h5>
<p id="section-14.3.6.2-1">The store call saves the connection identifier LINK in the account of the authenticating user.<a href="#section-14.3.6.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.6.2-2">
<pre>
HTTPS PUT /home/HOST_PART/LOCAL_PART/links/LINK
</pre><a href="#section-14.3.6.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="delete-1">
<section id="section-14.3.6.3">
            <h5 id="name-delete-2">
<a href="#section-14.3.6.3" class="section-number selfRef">14.3.6.3. </a><a href="#name-delete-2" class="section-name selfRef">Delete</a>
            </h5>
<p id="section-14.3.6.3-1">The delete call removes the given connection identifier LINK of the authenticating user.<a href="#section-14.3.6.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.6.3-2">
<pre>
HTTPS DELETE /home/HOST_PART/LOCAL_PART/links/LINK
</pre><a href="#section-14.3.6.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="vault">
<section id="section-14.3.7">
          <h4 id="name-vault">
<a href="#section-14.3.7" class="section-number selfRef">14.3.7. </a><a href="#name-vault" class="section-name selfRef">Vault</a>
          </h4>
<p id="section-14.3.7-1">Each mail agent allows storing arbitrary data in a key/value storage. The data SHOULD always be stored encrypted.
The minimum total vault storage that each mail agent MUST permit is 128 MB.<a href="#section-14.3.7-1" class="pilcrow">¶</a></p>
<p id="section-14.3.7-2">The vault is intended as an aid for synchronizing already retrieved messages among multiple clients, storing caches of profiles and images, mail client settings, stream subscriptions etc.<a href="#section-14.3.7-2" class="pilcrow">¶</a></p>
<div id="store-1">
<section id="section-14.3.7.1">
            <h5 id="name-store-2">
<a href="#section-14.3.7.1" class="section-number selfRef">14.3.7.1. </a><a href="#name-store-2" class="section-name selfRef">Store</a>
            </h5>
<p id="section-14.3.7.1-1">The store call will save any kind of data, storage permit, as KEY on the mail agent.<a href="#section-14.3.7.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.7.1-2">
<pre>
HTTPS PUT /home/HOST_PART/LOCAL_PART/vault/KEY
</pre><a href="#section-14.3.7.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="retrieve-2">
<section id="section-14.3.7.2">
            <h5 id="name-retrieve-3">
<a href="#section-14.3.7.2" class="section-number selfRef">14.3.7.2. </a><a href="#name-retrieve-3" class="section-name selfRef">Retrieve</a>
            </h5>
<p id="section-14.3.7.2-1">Previously stored data under KEY can be recalled from the mail agent using the retrieve call.<a href="#section-14.3.7.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.7.2-2">
<pre>
HTTPS GET /home/HOST_PART/LOCAL_PART/vault/KEY
</pre><a href="#section-14.3.7.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="archives">
<section id="section-14.3.8">
          <h4 id="name-archives">
<a href="#section-14.3.8" class="section-number selfRef">14.3.8. </a><a href="#name-archives" class="section-name selfRef">Archives</a>
          </h4>
<p id="section-14.3.8-1">Mail agents and local mail clients are not intended as a permanent message storage. That role is expected to be entrusted to an always online service which will store encrypted messages including their index and serve as centralized syncing endpoint for all connected mail clients - Message Archiving Services (MAS).<a href="#section-14.3.8-1" class="pilcrow">¶</a></p>
<p id="section-14.3.8-2">Using MAS is not required by Mail/HTTPS. Users may decide to use an online MAS or simply store messages locally upon archiving.<a href="#section-14.3.8-2" class="pilcrow">¶</a></p>
<p id="section-14.3.8-3">If a MAS is configured, ance the user archives a message in a email client, such message SHOULD first be uploaded to the archiving service (MAS) and upon success, removed from the local storage.<a href="#section-14.3.8-3" class="pilcrow">¶</a></p>
<p id="section-14.3.8-4">Archived messages SHOULD NOT be retrievable by email clients after the archiving process. This separation reduces the attack surface in case of compromised devices.<a href="#section-14.3.8-4" class="pilcrow">¶</a></p>
<p id="section-14.3.8-5">The API calls towards message archives are SOTN authenticated, just as with mail agents. Message archives authenticate the nonce signature with the public key available from the address profile. As such, they are capable of automatic keys updates.<a href="#section-14.3.8-5" class="pilcrow">¶</a></p>
<p id="section-14.3.8-6">Values stored are expected to be locally encrypted using a persisting anonymous public key encryption. The same encryption keys and passwords MUST never be used for mail agents on MAS services.<a href="#section-14.3.8-6" class="pilcrow">¶</a></p>
<p id="section-14.3.8-7">MAS offers only one way API to mail clients - for uploading messages. Message retrieval and deletion of archive messages SHOULD NOT be possible from mail clients.<a href="#section-14.3.8-7" class="pilcrow">¶</a></p>
<div id="store-2">
<section id="section-14.3.8.1">
            <h5 id="name-store-3">
<a href="#section-14.3.8.1" class="section-number selfRef">14.3.8.1. </a><a href="#name-store-3" class="section-name selfRef">Store</a>
            </h5>
<p id="section-14.3.8.1-1">The store call will save any kind of data, storage permit, as KEY on the message archive.<a href="#section-14.3.8.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14.3.8.1-2">
<pre>
HTTPS PUT /mail/HOST_PART/LOCAL_PART/archive/KEY
</pre><a href="#section-14.3.8.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC1866">[RFC1866]</dt>
        <dd>
<span class="refAuthor">Berners-Lee, T.</span> and <span class="refAuthor">D. Connolly</span>, <span class="refTitle">"Hypertext Markup Language - 2.0"</span>, <span class="seriesInfo">RFC 1866</span>, <span class="seriesInfo">DOI 10.17487/RFC1866</span>, <time datetime="1995-11" class="refDate">November 1995</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1866">https://www.rfc-editor.org/info/rfc1866</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3461">[RFC3461]</dt>
        <dd>
<span class="refAuthor">Moore, K.</span>, <span class="refTitle">"Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)"</span>, <span class="seriesInfo">RFC 3461</span>, <span class="seriesInfo">DOI 10.17487/RFC3461</span>, <time datetime="2003-01" class="refDate">January 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3461">https://www.rfc-editor.org/info/rfc3461</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5322">[RFC5322]</dt>
        <dd>
<span class="refAuthor">Resnick, P., Ed.</span>, <span class="refTitle">"Internet Message Format"</span>, <span class="seriesInfo">RFC 5322</span>, <span class="seriesInfo">DOI 10.17487/RFC5322</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5322">https://www.rfc-editor.org/info/rfc5322</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7033">[RFC7033]</dt>
        <dd>
<span class="refAuthor">Jones, P.</span>, <span class="refAuthor">Salgueiro, G.</span>, <span class="refAuthor">Jones, M.</span>, and <span class="refAuthor">J. Smarr</span>, <span class="refTitle">"WebFinger"</span>, <span class="seriesInfo">RFC 7033</span>, <span class="seriesInfo">DOI 10.17487/RFC7033</span>, <time datetime="2013-09" class="refDate">September 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7033">https://www.rfc-editor.org/info/rfc7033</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7235">[RFC7235]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span> and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Authentication"</span>, <span class="seriesInfo">RFC 7235</span>, <span class="seriesInfo">DOI 10.17487/RFC7235</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7235">https://www.rfc-editor.org/info/rfc7235</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7763">[RFC7763]</dt>
        <dd>
<span class="refAuthor">Leonard, S.</span>, <span class="refTitle">"The text/markdown Media Type"</span>, <span class="seriesInfo">RFC 7763</span>, <span class="seriesInfo">DOI 10.17487/RFC7763</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7763">https://www.rfc-editor.org/info/rfc7763</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8439">[RFC8439]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span> and <span class="refAuthor">A. Langley</span>, <span class="refTitle">"ChaCha20 and Poly1305 for IETF Protocols"</span>, <span class="seriesInfo">RFC 8439</span>, <span class="seriesInfo">DOI 10.17487/RFC8439</span>, <time datetime="2018-06" class="refDate">June 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8439">https://www.rfc-editor.org/info/rfc8439</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8615">[RFC8615]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Well-Known Uniform Resource Identifiers (URIs)"</span>, <span class="seriesInfo">RFC 8615</span>, <span class="seriesInfo">DOI 10.17487/RFC8615</span>, <time datetime="2019-05" class="refDate">May 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8615">https://www.rfc-editor.org/info/rfc8615</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9364">[RFC9364]</dt>
      <dd>
<span class="refAuthor">Hoffman, P.</span>, <span class="refTitle">"DNS Security Extensions (DNSSEC)"</span>, <span class="seriesInfo">BCP 237</span>, <span class="seriesInfo">RFC 9364</span>, <span class="seriesInfo">DOI 10.17487/RFC9364</span>, <time datetime="2023-02" class="refDate">February 2023</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9364">https://www.rfc-editor.org/info/rfc9364</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC9110">[RFC9110]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span>, <span class="refAuthor">Nottingham, M., Ed.</span>, and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"HTTP Semantics"</span>, <span class="seriesInfo">STD 97</span>, <span class="seriesInfo">RFC 9110</span>, <span class="seriesInfo">DOI 10.17487/RFC9110</span>, <time datetime="2022-06" class="refDate">June 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9110">https://www.rfc-editor.org/info/rfc9110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5234">[RFC5234]</dt>
      <dd>
<span class="refAuthor">Crocker, D., Ed.</span> and <span class="refAuthor">P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">STD 68</span>, <span class="seriesInfo">RFC 5234</span>, <span class="seriesInfo">DOI 10.17487/RFC5234</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dejan Strbac</span></div>
<div dir="auto" class="left"><span class="org">Mercata SagL</span></div>
<div dir="auto" class="left"><span class="street-address">via E. Bosia 5c.</span></div>
<div dir="auto" class="left">CH-<span class="postal-code">6900</span> <span class="locality">Paradiso</span>
</div>
<div dir="auto" class="left"><span class="country-name">Switzerland</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+41-78-6144568" class="tel">+41-78-6144568</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:dejan@mercata.com" class="email">dejan@mercata.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
